<div class="deal-history-item history-item-right">

    <div class="history-item-badge">
        <i class="fa fa-money"></i>
    </div>

    <div class='history-item-heading'>
        <a class="link-no-decoration" ui-sref="base.deals.detail({ id: vm.item.id })">{{ ::vm.item.name }}</a>
        <div class="btn-group pull-right">
            <a class="text-white" data-toggle="dropdown" aria-expanded="false">
                <i class="fa fa-angle-down"></i>
            </a>
            <ul class="dropdown-menu pull-right">
                <li><a ui-sref="base.deals.detail({ id: vm.item.id })"><i class="fa fa-eye"></i>View</a></li>
                <li><a ui-sref="base.deals.detail.edit({ id: vm.item.id })"><i class="fa fa-edit"></i>Edit</a></li>
                <li class='divider'></li>
                <li><a ng-href="/deals/delete/{{ ::vm.item.id }}/" data-target="#confirm-delete" data-source="/cases/delete/{{ ::vm.item.id }}/"><i class="fa fa-trash"></i>Delete</a></li>
            </ul>
        </div>
    </div>

    <div class="history-item-body first">
        <em style="white-space: pre-wrap;">{{ ::vm.item.body }}</em>
        <div class="timeline-footer">
            Last changed: {{ ::vm.item.modified | date:'dd MMMM yy HH:mm' }}<br/>
            Closing: {{ ::vm.item.closing_date | date:'dd MMMM yy HH:mm' }}<br/>
            {{ ::vm.item.new_business ? 'New business' : 'Existing business'}}<br/>
            {{ ::vm.item.feedback_form_sent ? 'Feedback form sent' : 'Feedback form not sent'}}<br/>
            Stage: {{ ::vm.item.stage_name}} ({{ ::vm.item.archived ? 'archived' : 'active'}})<br/>
            Amount once: &euro; {{ ::vm.item.amount_once }}<br/>
            Amount recurring: &euro; {{ ::vm.item.amount_recurring}}<br/><br/>
        </div>
        <ul class="list-inline list-justified">
            <li>
                <small class="text-muted" tooltip="Created on {{ ::vm.item.created| date:'dd MMMM yy' }} at {{ ::vm.item.created| date:'HH:mm' }}">
                    <i class="fa fa-calendar"></i>
                    {{ ::vm.item.created | date:'dd MMM yy HH:mm' }}
                </small>
            </li>
            <li>
                <small class="text-muted" tooltip="Assigned to: {{ ::vm.item.assigned_to_name }}">
                    <i class="fa fa-child"></i>
                    {{ ::vm.item.assigned_to_name || "Nobody" }}
                </small>
            </li>
            <li>
                <small class="text-muted" tooltip="Created by: {{ ::vm.item.created_by }}">
                    <i class="fa fa-user"></i>
                    {{ ::vm.item.created_by || "Nobody" }}
                </small>
            </li>
        </ul>
    </div>

    <history-add-note item="vm.item"></history-add-note>
    <div class='history-item-body next' ng-repeat="note in ::vm.item.notes">
        <p class='inline-header'><i class="fa fa-file-text-o"></i> Note</p>

        <p>{{ ::note.content }}</p>
        <ul class="list-inline list-justified">
            <li>
                <small class="text-muted" tooltip="Created on {{ ::note.date | date:'dd MMMM yy' }} at {{ ::note.date | date:'HH:mm' }}">
                    <i class="fa fa-calendar"></i>
                    {{ ::note.date | date:'dd MMMM yy HH:mm' }}
                </small>
            </li>
            <li>
                <small class="text-muted" tooltip="Created by: {{ ::note.author }}">
                    <i class="fa fa-user"></i>
                    {{ ::note.author }}
                </small>
            </li>
        </ul>

    </div>
</div>
