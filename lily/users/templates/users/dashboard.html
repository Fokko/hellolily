{% extends 'page.html' %}
{#{% extends 'mswadmin/base_user.html' %}#}

{% load bootstrap3 humanize i18n utils crispy_forms_tags media %}

{% block css %}
    {{ block.super }}
    {% include_media 'blog.css' %}
{% endblock %}

{% block head-title %}{% trans 'HelloLily' %}{% endblock %}
{% block page-title %}{% trans 'Dashboard' %}{% endblock %}

{% block scripts %}
    {{ block.super }}

    {% include_media 'lily.dashboard.js' %}
{% endblock %}

{% block page-container %}
<div class="row">
    <div class="col-md-12">
        <h4>{% trans 'Welcome to the HelloLily beta!' %}</h4>
    </div>
</div>    
<div class="row">
    <div class="col-md-12">
        <div class="alert alert-info">
            Lily no longer uses Trello for her issue management and migrated to a closed environment. We're sorry if this causes any inconveniences for you, but this way her issue tracking and planning is a lot more organized! If you find any bugs or want improvements please <a href="https://getsatisfaction.com/hellolily" target="_blank">report them</a>.
        </div>
    </div>
</div>    

<hr />

<div class="row">
    <div class="col-md-6">
        <h3><i class="icon-user"></i> {% trans 'Latest contacts' %}</h3>
        <table class="table">
            {% for item in contact_list %}
            <tr>
                <td>
                    <a href="{% url contact_details pk=item.pk %}" title="{% trans 'View details for ' %} {{ item }}">{{ item }}</a>
                </td>
                <td>
                    {{ item.created|naturaltime }}
                </td>
            </tr>
            {% endfor %}
            <tr>
                <td>
                </td>
                <td>
                    <a href="{% url contact_list %}">{% trans 'All contacts' %}</a>
                </td>
            </tr>
        </table>
    </div>
    <div class="col-md-6">
        <h3><i class="icon-briefcase"></i> {% trans 'Latest accounts' %}</h3>
        <table class="table">
            {% for item in account_list %}
            <tr>
                <td>
                    <a href="{% url account_details pk=item.pk %}" title="{% trans 'View details for ' %} {{ item }}">{{ item }}</a>
                </td>
                <td>
                    {{ item.created|naturaltime }}
                </td>
            </tr>
            {% endfor %}
            <tr>
                <td>
                </td>
                <td>
                    <a href="{% url account_list %}">{% trans 'All accounts' %}</a>
                </td>
            </tr>
        </table>
    </div>
</div>

<hr />

<div class="row">
    <div class="col-md-12 news-page blog-page">
        <div class="row">
            <div class="col-md-9 blog-tag-data">
                <h3><i class="icon-comments"></i> {% trans 'Microblog' %}</h3>

                <div id="microblog-form">
                    <div class="form-group">
                        <form method="post">
                            {% csrf_token %}

                            <div class="form-group">
                                {% bootstrap_field form.content layout="horizontal" form_group_class="form-group-inline" field_class="col-md-6 clearfix" show_label=False %}
                                <button type="submit" class="btn btn-primary">{% trans 'Post' %}</button>
                                <div class="clearfix"></div>
                            </div>
                        </form>
                    </div>
                </div>

                {% if has_tag_filter %}
                    <p>
                        {% trans 'Filtered by' %} '#{{ tag }}',
                        <a href="{% url dashboard %}">{% trans 'remove filter' %}</a>
                    </p>
                {% endif %}
                {% if blogentry_list|length %}

{# TODO: paginator styling #}
                    <ul id="microblog-paginator">
                        <li class="paginator previous {% if not page.has_previous %}disabled{% endif %}">
                            {% if page.has_previous %}
                                {% if has_tag_filter %}
                                    <a href="{% url dashboard_tag page=page.previous_page_number tag=tag %}">
                                {% else %}
                                    <a href="{% url dashboard page=page.previous_page_number %}">
                                {% endif %}
                            {% endif %}
                                &laquo; Previous
                            {% if page.has_previous %}</a>{% endif %}
                        </li>
                        <li class="paginator page current mws-form">
                            <form action="{% url dashboard %}" method="post" autocomplete="off">
                                {% csrf_token %}

                                {% if has_tag_filter %}
                                    <input type="hidden" name="tag" value="{{ tag }}"/>
                                {% endif %}

                                {% trans 'Page' %} <input type="text" name="page" class="page-number mws-textinput" value="{{ page.number }}" /> {% trans 'of' %} {{ paginator.num_pages }}
                                <input type="submit" class="hidden submit" value=""/>
                            </form>
                        </li>
                        <li class="paginator next {% if not page.has_next %}disabled{% endif %}">
                            {% if page.has_next %}
                                {% if has_tag_filter %}
                                    <a href="{% url dashboard_tag page=page.next_page_number tag=tag %}">
                                {% else %}
                                    <a href="{% url dashboard page=page.next_page_number %}">
                                {% endif %}
                            {% endif %}
                                Next &raquo;
                            {% if page.has_next %}</a>{% endif %}
                        </li>
                    </ul>

{# TODO: below is just a hardcoded example from the metronic theme. We can use this for the microblog. #}
                    <div class="media">
                        <h3>Comments</h3>
                        <a href="#" class="pull-left">
                        <img alt="" src="" class="media-object">
                        </a>
                        <div class="media-body">
                            <h4 class="media-heading">Media heading
                            <span>
                                5 hours ago / <a href="#">Reply</a>
                            </span>
                            </h4>
                            <p>
                                Donec id elit non mi porta gravida at eget metus. Fusce 
    dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut 
    fermentum massa justo sit amet risus. Etiam porta sem malesuada magna 
    mollis euismod. Donec sed odio dui.
                            </p>
                            <hr>
                            <!-- Nested media object -->
                            <div class="media">
                                <a href="#" class="pull-left">
                                <img alt="" src="" class="media-object">
                                </a>
                                <div class="media-body">
                                    <h4 class="media-heading">Media heading
                                    <span>
                                        17 hours ago / <a href="#">Reply</a>
                                    </span>
                                    </h4>
                                    <p>
                                        Donec id elit non mi porta gravida at eget metus. Fusce 
    dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut 
    fermentum massa justo sit amet risus. Etiam porta sem malesuada magna 
    mollis euismod. Donec sed odio dui.
                                    </p>
                                </div>
                            </div>
                            <!--end media-->
                            <hr>
                            <div class="media">
                                <a href="#" class="pull-left">
                                <img alt="" src="" class="media-object">
                                </a>
                                <div class="media-body">
                                    <h4 class="media-heading">Media heading
                                    <span>
                                        2 days ago / <a href="#">Reply</a>
                                    </span>
                                    </h4>
                                    <p>
                                        Donec id elit non mi porta gravida at eget metus. Fusce 
    dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut 
    fermentum massa justo sit amet risus. Etiam porta sem malesuada magna 
    mollis euismod. Donec sed odio dui.
                                    </p>
                                </div>
                            </div>
                            <!--end media-->
                        </div>
                    </div>

                    <ul id="blogentries">

{# TODO: put the blogentry list below in the new theme using the example above. #}
                        {% for item in blogentry_list %}
                        <li>
                            <div id="entry-{{ item.id }}" class="blogentry clearfix parent" data-entry-id="{{ item.id }}">
                                <div>
                                    <strong>{{ item.author }}</strong>
                                </div>
                                <div class="blogentry-content">
                                    <div class="controls">{% if request.user == item.author %}<a href="{% url blogentry_delete pk=item.id %}" class="blogentry-delete">{% trans 'Delete' %}</a> - {% endif %}<a href="javascript:void(0)" class="blogentry-reply">{% trans 'Reply' %}</a></div>
                                    <div class="content">
                                        {% if item.reply_to %}<a href="javascript:" class="replied-to" data-replied-to="{{ item.reply_to.id }}">@{{ item.reply_to.author }}</a>: {% endif %}{{ item.content|linebreaksbr|uri_detect|tags_to_uri|safe }}
                                    </div>
                                </div>
                                <div class="date created">
                                    {{ item.created|naturaltime }}
                                </div>
                            </div>
                            {% if item.get_replies|length %}
                                {% block render_replies %}
                                    {% include 'mwsadmin/base_list.html' with list=item.get_replies list_item_template='updates/mwsadmin/child_list_item.html' %}
                                {% endblock %}
                            {% endif %}
                        </li>
                        {% endfor %}

                    </ul>
                {% else %}
                    <p>
                        {% if has_tag_filter %}
                            {% blocktrans with tag=tag %}No entries found for #{{ tag }}.{% endblocktrans %} <a href="{% url dashboard %}">{% trans 'Show everything' %}</a>.
                        {% else %}
                            {% trans 'There are no entries in the microblog yet.' %}
                        {% endif %}
                    </p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% if user|in_group:'account_admin' %}
<hr />
<div class="row">
    <div class="col-md-12">
        <h3>Other things you can do</h3>
        <a href="{% url invitation_invite %}">click</a> <span class="things-you-can-do">Send invitations to new users</span>
    </div>
</div>
{% endif %}
{% endblock %}
