!function(e){"use strict";e.module("app.accounts",["ngCookies","ui.bootstrap","ui.slimscroll","app.accounts.services","app.cases.services","app.email.services","app.contacts.services","noteServices"])}(angular),function(e){"use strict";e.module("app.cases",["ngCookies","ui.bootstrap","app.accounts.services","app.cases.services","app.email.services","app.contacts.services","noteServices"])}(angular),function(e){"use strict";e.module("app.contacts",["ngCookies","ui.bootstrap","app.accounts.services","app.cases.services","app.contacts.services","noteServices","app.email.services"])}(angular),function(e){"use strict";e.module("app.dashboard",["app.dashboard.directives","app.users.services","chart.js","ui.slimscroll"])}(angular),function(e){"use strict";e.module("app.deals",["ngCookies","ui.bootstrap","ui.select","app.deals.services"])}(angular),function(e){"use strict";e.module("app.email",["ui.bootstrap","ui.router","app.email.services","app.email.directives","app.services"])}(angular),function(e){"use strict";e.module("app.accounts.directives",[])}(angular),function(e){"use strict";e.module("app.base",["ui.bootstrap"])}(angular),function(e){"use strict";e.module("app.directives",[])}(angular),function(e){"use strict";e.module("app.filters",[])}(angular),function(e){"use strict";e.module("app.services",[])}(angular),function(e){"use strict";e.module("app.cases.directives",[])}(angular),function(e){"use strict";e.module("app.cases.services",["ngResource"])}(angular),function(e){"use strict";e.module("app.contacts.directives",[])}(angular),function(e){"use strict";e.module("app.contacts.services",["ngResource"])}(angular),function(e){"use strict";e.module("app.dashboard.directives",[])}(angular),function(e){"use strict";e.module("app.deals.directives",[])}(angular),function(e){"use strict";e.module("app.deals.services",[])}(angular),function(e){"use strict";e.module("app.email.directives",[])}(angular),function(e){"use strict";e.module("app.email.services",["ngResource"])}(angular),function(e){"use strict";!function(){function t(e,t,a){function n(e,a,n,i,r){var o="";return r&&(o+="-"),o+=i,t({url:"/search/search/",method:"GET",params:{type:"accounts_account",q:e,page:a-1,size:n,sort:o}}).then(function(e){return{accounts:e.data.hits,total:e.data.total}})}function i(){var t=this,a=e("filter")(t.email_addresses,{status:2});return a.length?a[0]:t.email_addresses.length?t.email_addresses[0]:void 0}var r=a("/api/accounts/account/:id",null,{update:{method:"PUT",params:{id:"@id"}},"delete":{method:"DELETE"}});return r.getAccounts=n,r.prototype.getEmailAddress=i,r}e.module("app.accounts.services",["ngResource"]),e.module("app.accounts.services").factory("AccountDetail",["$resource",function(t){function a(e){return e.phone_mobile?e.phone_mobile[0]:e.phone_work?e.phone_work[0]:e.phone_other?e.phone_other[0]:""}function n(e){var t=[];return e.phone_mobile&&(t=t.concat(e.phone_mobile)),e.phone_work&&(t=t.concat(e.phone_work)),e.phone_other&&(t=t.concat(e.phone_other)),t}return t("/search/search/?type=accounts_account&filterquery=id::id",{},{get:{transformResponse:function(t){if(t=e.fromJson(t),t&&t.hits&&t.hits.length>0){var i=t.hits[0];return i.phone=a(i),i.phones=n(i),i}return null}}})}]),e.module("app.accounts.services").factory("Account",t),t.$inject=["$filter","$http","$resource"]}()}(angular),function(e){"use strict";!function(e,t,a,n,i,r,o){e.GoogleAnalyticsObject=i,e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},e[i].l=1*new Date,r=t.createElement(a),o=t.getElementsByTagName(a)[0],r.async=1,r.src=n,o.parentNode.insertBefore(r,o)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-60721851-1","auto")}(angular),function(e){"use strict";function t(e){var t={layout:{pageSidebarClosed:!1}};return e.settings=t,t}function a(e,t,a,n,i){e.setOptions({templateUrl:"base/breadcrumbs.html",includeAbstract:!0}),t.allowGlobals(),a.defaults.xsrfCookieName="csrftoken",a.defaults.xsrfHeaderName="X-CSRFToken",n.defaults.stripTrailingSlashes=!1,i.otherwise("/")}function n(e,t){e.$state=t,e.currentUser=currentUser}e.module("app",["ui.router","ui.bootstrap","ngResource","ngSanitize","ncy-angular-breadcrumb","app.accounts","app.base","app.cases","app.contacts","app.dashboard","app.email","app.preferences","app.preferences.email","app.preferences.user","app.templates","app.deals","UtilsControllers","app.directives","app.accounts.directives","app.cases.directives","app.contacts.directives","app.deals.directives","UtilsDirectives","angulartics","angulartics.google.analytics","app.services","app.filters"]),e.module("app").factory("settings",t),t.$inject=["$rootScope"],e.module("app").config(a),a.$inject=["$breadcrumbProvider","$controllerProvider","$httpProvider","$resourceProvider","$urlRouterProvider"],e.module("app").run(n),n.$inject=["$rootScope","settings","$state"]}(angular),function(e){"use strict";$("body").on("blur",'input[name^="phone"]',function(){var e=$(this),t=e.val();if(t.match(/[a-z]|[A-Z]/))return!1;if(t.match(/^\+316|^06/)){var a=e.attr("id").replace("raw_input","type");$("#"+a).select2("val","mobile")}return t=t.replace("(0)","").replace(/\s|\(|\-|\)|\.|x|:|\*/g,"").replace(/^00/,"+"),0==t.length?!1:(t.startsWith("+")||(t.startsWith("0")&&(t=t.substring(1)),t="+31"+t),t.startsWith("+310")&&(t="+31"+t.substring(4)),void e.val(t))}),$("body").on("change",'select[id*="is_primary"]',function(e){"True"==$(e.currentTarget).val()&&($('select[id*="is_primary"]').each(function(e){$(this).is("select")&&"True"==$(this).val()&&$(this).val("False")}),$(e.currentTarget).val("True"),HLSelect2.init())})}(angular),function(e){"use strict";!function(e,t,a,n){var i;t.HLCases={config:{caseUpdateUrl:"/cases/update/status/",caseUpdateAssignedToUrl:"/cases/update/assigned_to/",caseId:null,statusSpan:"#status",statusDiv:"#case-status",parcelProviderSelect:"#id_parcel_provider",parcelIdentifierInput:"#id_parcel_identifier",assignedToField:"#id_assigned_to",assignToMeButton:".assign-me-btn",currentAssignedTo:null},init:function(t){var a=this;e.isPlainObject(t)&&e.extend(a.config,t),a.initListeners(),a.setCurrentStatus()},initListeners:function(){var t=this,a=t.config;e(a.statusDiv).on("click",function(e){t.changeStatus.call(t,e)}),e(a.parcelProviderSelect).on("change",function(){t.changedParcelProviderSelect.call(t,this)}),e(a.assignToMeButton).on("click",function(){t.changeAssignedTo.call(t,this)})},setCurrentStatus:function(){i=e("input[name=radio]:checked",this.config.statusDiv).closest("label").attr("for")},changeStatus:function(t){var a=this,n=a.config,r=e("#"+e(t.target).closest("label").attr("for"));if(r.attr("id")!=i){var o=e(r);null!=n.caseId&&e.ajax({url:n.caseUpdateUrl+n.caseId+"/",type:"POST",data:{status:o.val()},beforeSend:HLApp.addCSRFHeader,dataType:"json"}).done(function(t){i=o.attr("id"),e(n.statusSpan).text(t.status),load_notifications()}).fail(function(){e(r).attr("checked",!1).closest("label").removeClass("active"),e("#"+i).attr("checked",!0).closest("label").addClass("active"),load_notifications()})}},changedParcelProviderSelect:function(t){var a=e(t);a.val()||e(this.config.parcelIdentifierInput).val("")},changeAssignedTo:function(){var t=this,a=t.config,n=null;a.currentAssignedTo!=currentUser.id&&(n=currentUser.id),null!=a.caseId&&e.ajax({url:a.caseUpdateAssignedToUrl+a.caseId+"/",type:"POST",data:{assignee:n},beforeSend:HLApp.addCSRFHeader,dataType:"json"}).done(function(t){var n=t.assignee;n?(e(".summary-data.assigned-to").html(t.assignee.name),e(".assign-me-btn").html("Unassign"),a.currentAssignedTo=t.assignee.id):(e(".summary-data.assigned-to").html("Unassigned"),e(".assign-me-btn").html("Assign to me"),a.currentAssignedTo=null)}).always(function(){load_notifications()})},addAssignToMeButton:function(){var t=this,a=e('<button class="btn btn-link assign-me-btn">Assign to me</button>');e(t.config.assignedToField).after(a),a.click(function(a){a.preventDefault(),e(t.config.assignedToField).val(currentUser.id).change()})}}}(jQuery,window,document)}(angular),function(e){"use strict";!function(e,t,a,n){t.HLEmailTemplates={config:{insertButton:"#id_insert_button",variablesField:"#id_variables",fileUploadField:"#body_file_upload",valuesField:"#id_values",bodyFileField:"#id_body_file",templateVariableField:"#id_text_value",attachmentDeleteButton:".email-template-attachments [data-formset-delete-button]",attachmentUndoDeleteButton:".email-template-attachments [data-formset-undo-delete]",templateAttachmentName:".template-attachment-name",wysiHtmlToolbar:"#wysihtml5-toolbar",submitButton:'button[type="submit"]'},init:function(t){var a=this;e.extend(this.config,t),a.initListeners(),a.updateVariableOptions()},initListeners:function(){var t=this,a=t.config;e("body").on("click",a.insertButton,function(t){var n=e(a.templateVariableField).html();HLInbox.getEditor().focus(),HLInbox.getEditor().composer.commands.exec("insertHTML",n),t.preventDefault()}).on("change",a.variablesField,function(){t.updateVariableOptions()}).on("click",a.fileUploadField,function(t){e(a.bodyFileField).click(),t.preventDefault()}).on("change",a.valuesField,function(){t.handleValueChange.call(t,this)}).on("change",a.bodyFileField,function(){t.handleBodyFileChange.call(t,this)}).on("click",a.attachmentDeleteButton,function(){var a=e(this).closest(".form-group");t.toggleMarkDeleted(a)}).on("click",a.attachmentUndoDeleteButton,function(){var a=e(this).closest(".form-group");t.toggleMarkDeleted(a)}).on("click",a.submitButton,function(e){t.handleFormSubmit(this,e)});var n=e(a.wysiHtmlToolbar);e(n).find('a[data-wysihtml5-command="formatBlock"]').click(function(t){var a=t.target||t.srcElement,i=e(a);e(n).find(".current-font").text(i.html())})},updateVariableOptions:function(){var t=e(this.config.valuesField),a=e(this.config.variablesField).val();t.find("option").not('option[value=""]').remove(),t.change();var n={Contact:{"contact.full_name":"Full name","contact.work_phone":"Work phone","contact.last_name":"Last name","contact.twitter":"Twitter","contact.mobile_phone":"Mobile phone","contact.first_name":"First name","contact.linkedin":"Linkedin","contact.preposition":"Preposition","contact.primary_email":"Primary email","contact.account_city":"Account city"},User:{"user.full_name":"Full name","user.first_name":"First name","user.phone_number":"Phone number","user.preposition":"Preposition","user.linkedin":"Linkedin","user.twitter":"Twitter","user.current_email_address":"Current email address","user.last_name":"Last name","user.user_group":"User group"},Account:{"account.work_phone":"Work phone","account.name":"Name","account.any_email_address":"Any email address"}};""!==a&&e.each(n[a],function(a,n){t.append(e("<option>",{value:a,text:n}))})},handleValueChange:function(t){var a=e(this.config.templateVariableField),n=e(t).val();a.html(""!==n?this.config.openVariable+" "+n+" "+this.config.closeVariable:"")},handleBodyFileChange:function(t){var a=e(t).closest("form"),n=a.find(t).val();n&&e(a).ajaxStart(function(){Metronic.blockUI(e(a).nextAll("form").eq(0),!1,"")}).ajaxStop(function(){Metronic.unblockUI(e(a).nextAll("form").eq(0))}).ajaxSubmit({type:"post",dataType:"json",url:this.config.parseEmailTemplateUrl,success:function(t){if(!t.error&&t.form){var a=["name","subject"];e.each(a,function(a,n){t.form.hasOwnProperty(n)&&e("#id_"+n).val(t.form[n])}),HLInbox.getEditor().setValue(t.form.body_html),HLInbox.getEditor().focus(),HLInbox.getEditor().composer.element.blur()}load_notifications()},error:function(){load_notifications()}})},toggleMarkDeleted:function(e){var t=e.find(this.config.templateAttachmentName);t.hasClass("mark-deleted")?t.removeClass("mark-deleted"):t.addClass("mark-deleted")},handleFormSubmit:function(t,a){a.preventDefault();var n=e("<div>");n[0].innerHTML=HLInbox.getEditor().getValue(),n.find("#resize-div").remove(),e("#id_body_html").val(n[0].innerHTML);var i=e(e(t).closest("form"));Metronic.blockUI(e(".inbox-content"),!1,""),i.submit()}}}(jQuery,window,document)}(angular),function(e){"use strict";!function(e,t,a,n){var i;t.HLInbox={config:{accountDeactivatedMessage:"Your account doesn't seem to be active. Please activate your account to view your email.",inboxCcInput:".inbox-compose .mail-to .inbox-cc",inboxBccInput:".inbox-compose .mail-to .inbox-bcc",singleMessageSelector:".inbox-content .view-message",templateField:"#id_template",inboxComposeSubmit:'.inbox-compose [type="submit"]',wysiHtmlToolbar:"#wysihtml5-toolbar",replyButton:".reply-btn",tagsAjaxSelector:".tags-ajax",emailAccountInput:"#id_send_from",sendToNormalField:"#id_send_to_normal",overwriteTemplateConfirm:"Selecting a different template will overwrite the text you've typed. Do you want to load the template anyway?",emptyTemplateAttachmentRow:"#empty-template-attachment-row",templateAttachmentDeleteButton:"#template-attachments [data-formset-delete-button]",templateAttachmentUndoDeleteButton:"#template-attachments [data-formset-undo-delete]",templateAttachmentsDiv:"#template-attachments",templateAttachmentName:".template-attachment-name",templateAttachmentIds:"#template-attachment-ids",templateAttachmentId:".template-attachment-id",templateAttachmentRow:".template-attachment-row",currentTemplate:null,previousSendToNormalLength:0},init:function(t){var a=this;e.extend(this.config,t),a.initListeners(),Metronic.initUniform()},initListeners:function(){var t=this,a=t.config;e("body").on("click",a.inboxCcInput,function(){t.handleAdditionalRecipientsInput("cc")}).on("click",a.inboxBccInput,function(){t.handleAdditionalRecipientsInput("bcc")}).on("change",a.emailAccountInput,function(){t.changeTemplateField.call(t,a.templateField,!1)}).on("change",a.templateField,function(){t.changeTemplateField.call(t,this,!0)}).on("change",a.sendToNormalField,function(){var n=t.config.previousSendToNormalLength,i=e(this).select2("data").length;return t.config.previousSendToNormalLength=i,i>1||n>i?!1:void t.changeTemplateField.call(t,a.templateField,!1)}).on("click",a.replyButton,function(){e(".inbox-view").hide(),e(".inbox-loading").show()}).on("click",a.inboxComposeSubmit,function(e){t.handleInboxComposeSubmit(this,e)}).on("change",a.tags,function(){t.handleTagsAjaxChange(this)}).on("click",a.templateAttachmentDeleteButton,function(){var a=e(this).closest(".form-group");t.handleTemplateAttachmentsChange(a)}).on("click",a.templateAttachmentUndoDeleteButton,function(){var a=e(this).closest(".form-group");t.handleTemplateAttachmentsChange(a)}),e(".inbox-compose input").on("keydown keyup keypress",function(e){13==e.which&&e.preventDefault()})},customParser:function(){function e(e,t,a,n){return e}return e},initEmailCompose:function(t){var a=this;e.extend(a.config,t),a.initWysihtml5(),null!==a.config.loadDefaultTemplate&&(a.config.loadDefaultTemplate?a.loadDefaultEmailTemplate():e(a.config.templateField).val(a.config.template).change()),a.config.recipient&&e(a.config.sendToNormalField).select2("data",a.config.recipient);var n=a.decodeEntities(i.getValue()),r=e(n).closest("#compose-email-template");r.length&&(a.config.currentTemplate=r[0].innerHTML)},decodeEntities:function(e){var t=a.createElement("div");return e&&"string"==typeof e&&(e=e.replace(/<script[^>]*>([\S\s]*?)<\/script>/gim,""),e=e.replace(/<\/?\w(?:[^"'>]|"[^"]*"|'[^']*')*>/gim,""),t.innerHTML=e,e=t.textContent,t.textContent=""),e},initWysihtml5:function(){var a=this;i=new wysihtml5.Editor("id_body_html",{toolbar:"wysihtml5-toolbar",parser:a.customParser(),handleTables:!1}),i.observe("load",function(){a.config.initialEditorValue=i.getValue(),i.setValue(a.config.initialEditorValue+'<div id="resize-div"></div>'),e(this.composer.element).on("keydown paste change focus blur",function(){a.resizeEditor()}),a.resizeEditor()});var n=e(a.config.wysiHtmlToolbar);e(n).find('a[data-wysihtml5-command="formatBlock"]').click(function(t){var a=t.target||t.srcElement,i=e(a);e(n).find(".current-font").text(i.html())}),e(t).on("resize",function(){a.resizeEditor()})},resizeEditor:function(){e(".wysihtml5-sandbox")[0].style.height=i.composer.element.scrollHeight+"px"},handleAdditionalRecipientsInput:function(t){var a=e(".inbox-compose .mail-to .inbox-"+t),n=e(".inbox-compose .input-"+t);a.hide(),n.show(),e(".close",n).click(function(){n.hide(),a.show(),n.find(".tags").select2("val","")})},changeTemplateField:function(t,a){var n=this;if(n.config.templateList){var i=parseInt(e(t).val()),r=null,o=e(n.config.emailAccountInput).val();if(o){if(i){var s=e("#id_send_to_normal").select2("data")[0];"undefined"!=typeof s&&"undefined"!=typeof s.object_id?r=s.object_id:""!==n.config.sender&&null!=n.config.sender&&(r=n.config.sender,n.config.sender=null);var c=n.config.getTemplateUrl+i+"/";c+=null!=r?"?contact_id="+r+"&emailaccount_id="+o:"?emailaccount_id="+o,e.getJSON(c,function(e){n.setNewEditorValue(e,a)})}}else toastr.error("I couldn't load the template because your email account doesn't seem to be set. Please check your email account and try again")}},handleInboxComposeSubmit:function(a,n){n.preventDefault();var i=e(a).attr("name"),r=e(e(a).closest("form"));if("submit-discard"==i)return void(t.location="/#/email/all/INBOX");if("submit-send"==i){if(!e("#id_send_to_normal").val()&&!e("#id_send_to_cc").val()&&!e("#id_send_to_bcc").val())return e("#modal_no_email_address").modal(),void n.preventDefault()}else if("submit-save"==i){var o=e("#id_draft_pk").val();o?r.attr("action","/messaging/email/draft/"+o+"/"):r.attr("action","/messaging/email/draft/")}else{if("submit-send-archive"!=i)return;e("<input />").attr("type","hidden").attr("name","archive").attr("value",!0).appendTo(r)}var s=e('<div id="email-container-div">');s[0].innerHTML=HLInbox.getEditor().getValue();var c="";"submit-save"!=i&&s.find("#compose-email-template").length&&(c=s.find("#compose-email-template")[0].innerHTML,s.find("#compose-email-template").remove()),s.find("#resize-div").remove(),e("#id_body_html").val(c+"<br>"+s[0].innerHTML),e('button[name="'+i+'"]').button("loading"),e("[id|=id_attachments]:file").filter(function(){return 1==e(a).data("formset-disabled")}).remove(),Metronic.blockUI(e(".inbox-content"),!1,""),r.submit()},handleTagsAjaxChange:function(t){for(var a=[],n=e(t).select2("data"),i=0;i<n.length;i++){var r=n[i];a.push(r.id)}e(t).val(a.join())},getEditor:function(){return i},loadDefaultEmailTemplate:function(){var t=this,a=e(t.config.emailAccountInput).val();if(a){var n=t.config.defaultEmailTemplateUrl+a+"/";e.getJSON(n,function(a){e(t.config.templateField).select2("val",a.template_id).change()})}else toastr.error("Sorry, I couldn't load your default email template. You could try reloading the page")},setNewEditorValue:function(t,a){var n=this,r=t.template,o=e(i.getValue()),s=o.closest("#compose-email-template"),c="";if(s.length){if(s.html().length){var l=!1;if(l=a?confirm(n.config.overwriteTemplateConfirm):!0){var u="";if(n.config.currentTemplate){var d={};d="draft"==n.config.messageType&&r==n.config.currentTemplate?JsDiff.diffChars(s.html(),r):JsDiff.diffChars(s.html(),n.config.currentTemplate),d.forEach(function(e){(e.added||e.removed)&&(u+=e.value)})}n.config.currentTemplate=r,s.html(r+u);var m=e("<div>");m.append(o),c=m[0].innerHTML}}}else{var f='<div id="compose-email-template">'+r+"</div>";c=f+"<br>"+i.getValue(),n.config.currentTemplate=r}"new"===this.config.messageType&&""!=t.template_subject&&e("#id_subject").val(t.template_subject),c.length&&(i.setValue(c),n.resizeEditor(),n.processAttachments(t.attachments))},processAttachments:function(t){var a=this.config;e(a.templateAttachmentsDiv).empty();for(var n=[],i=0;i<t.length;i++){var r=t[i];n.push(r.id);var o=e(a.emptyTemplateAttachmentRow).clone();o.find(a.templateAttachmentName).html(r.name),o.find(a.templateAttachmentId).val(r.id),o.removeAttr("id"),o.removeClass("hidden"),e(a.templateAttachmentsDiv).append(o)}e(a.templateAttachmentIds).val(n)},handleTemplateAttachmentsChange:function(t){var a=this,n=a.config,i=t.find(n.templateAttachmentName);i.hasClass("mark-deleted")?i.removeClass("mark-deleted"):i.addClass("mark-deleted"),t.find("[data-formset-delete-button]").toggleClass("hidden"),t.find("[data-formset-undo-delete]").toggleClass("hidden");var r=[],o=e(n.templateAttachmentRow);o.each(function(){if(!e(this).find(n.templateAttachmentName).hasClass("mark-deleted")){var t=e(this).find(n.templateAttachmentId).val();""!==t&&r.push(t)}}),e(n.templateAttachmentIds).val(r)},setSuccesURL:function(t){null!=t&&e("input[name='success_url']").val(t)}}}(jQuery,window,document)}(angular),function(e){"use strict";!function(e,t,a,n){t.HLFormsets={config:{formsetClass:".formset"},init:function(t){var a=this;e.isPlainObject(t)&&e.extend(a.config,t),e(a.config.formsetClass).formset(),a.initListeners()},initListeners:function(){var t=e("body");t.on("formAdded","[data-formset-form]",function(){var t=e(this).parents(".formset"),a=e(t).find(".add-link"),n="true"==(e(t).attr("data-formset-indent")||"true");n&&e(a).find(".form-control-static").addClass("col-md-offset-2").removeClass("form-control-static"),e(a).find("label").addClass("hide"),1===e(t).find("[data-formset-form]").length&&(e(this).find("label.hide").removeClass("hide"),n&&e(this).find(".field_wrapper").removeClass("col-md-offset-2")),HLSelect2.init()}),t.on("formDeleted","[data-formset-form]",function(){e(this).stop().slideDown(),e(this).find(":input:enabled:visible").attr("data-formset-disabled",!0).attr("readonly","readonly"),e(this).find("[data-formset-delete-button]").toggleClass("hidden"),e(this).find("[data-formset-undo-delete]").toggleClass("hidden")}),t.on("click","[data-formset-form] [data-formset-undo-delete]",function(){var t=e(this).closest("[data-formset-form]");t.find("[data-formset-disabled=true]").removeAttr("data-formset-disabled").removeAttr("readonly"),t.find('input[name$="DELETE"]').attr("checked",!1).change(),t.find("[data-formset-delete-button]").toggleClass("hidden"),e(this).toggleClass("hidden")})}}}(jQuery,window,document)}(angular),function(e){"use strict";!function(e,t,a,n){t.HLSelect2={config:{tagInputs:"input.tags",ajaxInputs:"input.select2ajax",tagsAjaxClass:"tags-ajax",ajaxPageLimit:30,clearText:"-- Clear --"},init:function(t){var a=this;e.isPlainObject(t)&&e.extend(a.config,t),a.setupSelect2(),a.initListeners()},initListeners:function(){var t=this;e(a).on("shown.bs.modal",".modal",function(){t.setupSelect2()})},setupSelect2:function(){e("select").select2({minimumResultsForSearch:9}),this.createTagInputs(),this.createAjaxInputs()},createTagInputs:function(){e(this.config.tagInputs).each(function(){if(!e(this).data().hasOwnProperty("select2")){var t=[],a=e(this);a.data("choices")&&(t=a.data("choices").split(",")),a.select2({tags:t,tokenSeparators:[","," "],width:"100%"})}})},createAjaxInputs:function(){var t=this,a=t.config;e(a.ajaxInputs).each(function(){var t=e(this),n=t.data();if(!n.hasOwnProperty("select2")){var i={ajax:{cache:!0,data:function(i,r){var o=null;if(t.hasClass(a.tagsAjaxClass)&&!n.tags){""===i&&(i="*");var s="((_type:contacts_contact AND (name:"+i+" OR email_addresses.email_address:"+i+")) OR (_type:accounts_account AND (name:"+i+" OR email_addresses.email_address:"+i+"))) AND email_addresses.email_address:*";o={filterquery:s,size:a.ajaxPageLimit,page:r-1,sort:"-modified"}}else{var c=i.trim();o={filterquery:c?"name:("+c+")":"",size:a.ajaxPageLimit,page:r-1,sort:"-modified"}}var l=t.data("filter-on");return"undefined"!=typeof l&&""!==l&&l.split(",").forEach(function(t){if(0===t.indexOf("id_")){var a=e("#"+t).val(),n=t.substring(3);0===n.indexOf("case_quickbutton_")?n=t.substring(20):"account"==n&&(n="accounts.id"),a&&a>0&&(o.filterquery+=" "+n+":"+a)}else o.type=t}),o},results:function(e,i){var r=i*a.ajaxPageLimit<e.total;if(t.hasClass(a.tagsAjaxClass)&&!n.tags){var o=[];e.hits.forEach(function(e){for(var t=0;t<e.email_addresses.length;t++){var a='"'+e.name+'" <'+e.email_addresses[t].email_address+">",n=e.name+" <"+e.email_addresses[t].email_address+">";o.push({id:a,text:n,object_id:e.id})}}),e.hits=o}else e.hits.forEach(function(e){e.text=e.name});return 1!=i||t.hasClass(a.tagsAjaxClass)||n.tags||e.hits.unshift({id:-1,text:a.clearText}),{results:e.hits,more:r}}},initSelection:function(e,t){var a=e.val(),n=e.data("selected-text"),i={id:a,text:n};t(i)}};t.hasClass(a.tagsAjaxClass)&&(i.tags=!0,i.tokenSeparators=[","," "],i.createSearchChoice=function(t,a){return 0===e(a).filter(function(){return 0===this.text.localeCompare(t)}).length?{id:t,text:t}:void 0},i.openOnEnter=!1),n.tags&&(i.tags=!0,i.multiple=!0),t.select2(i),n.tags&&t.select2("data",n.initial)}})}}}(jQuery,window,document)}(angular),function(e){"use strict";!function(e,t,a,n){t.HLShowAndHide={config:{selector:".show-and-hide-input"},init:function(t){var a=this;e.isPlainObject(t)&&e.extend(a.config,t),a.initListeners()},initListeners:function(){e("body").on("click",".form .toggle-original-form-input",function(){var t=e(this).closest(".show-and-hide-input");if(e(this).parent().addClass("hide"),"show"==e(this).data("action")){e(t).find('[data-action="hide"]').parent().removeClass("hide"),e(t).find(".original-form-widget").removeClass("hide"),e(t).find(":input").removeAttr("disabled");var a=e(t).find(':input:visible:not([type="file"]):first');a&&setTimeout(function(){},0)}else"hide"==e(this).data("action")&&(e(t).find('[data-action="show"]').parent().removeClass("hide"),e(t).find(".original-form-widget").addClass("hide"),e(t).find(":input").attr("disabled","disabled"))})}}}(jQuery,window,document)}(angular),function(e){"use strict";!function(e,t,a,n){t.HLDataProvider={config:{buttonDataProvider:":button.dataprovider",loadingText:"Beaming up the information now, almost within range!",loadingHeader:"I'm on my way!",provideUrl:"/provide/account/",dataProviderClass:".dataprovider",errorHeader:"Oops!",errorText:"There was an error trying to fetch your data, please don't be mad.",successHeader:"Yeah!",successText:"We did it! Your new data should be right there waiting for you.",hiddenSuccessHeader:"Psst!",hiddenSuccessText:"Did you know I did more work in the background? ;)",overwriteConfirmHeader:"Do you wish to overwrite the following fields?\n",fields:["name","description","legalentity","taxnumber","bankaccountnumber","cocnumber","iban","bic"],formsets:["email_addresses","phone_numbers","addresses"]},init:function(t){var a=this;e.isPlainObject(t)&&e.extend(a.config,t),a.initListeners()},initListeners:function(){var t=this,a=t.config;e("body").on("click",a.buttonDataProvider,function(e){t.findDataProviderInfo.call(t,this,e)}).on("keydown","div"+a.dataProviderClass+" > input",function(e){13===e.which&&(t.findDataProviderInfo.call(t,a.buttonDataProvider,e),e.preventDefault())})},findDataProviderInfo:function(t,a){var n=this,i=n.config,r=e(t),o=r.closest("form"),s=e("div"+i.dataProviderClass+" > input"),c=n.sanitizeDomain(s.val());r.button("loading"),toastr.info(i.loadingText,i.loadingHeader);var l=i.provideUrl+c;e.getJSON(l).done(function(e){e.error?toastr.error(e.error.message,i.errorHeader):(n.fillForm(o,e,i.fields,i.formsets),toastr.success(i.successText,i.successHeader))}).fail(function(){toastr.error(i.errorText,i.errorHeader)}).always(function(){r.button("reset")}),a.preventDefault()},sanitizeDomain:function(t){var a=e.trim(t.replace("http://",""));return a=e.trim(a.replace("https://","")),"/"!==a.slice(-1)&&(a+="/"),a},fillForm:function(e,t,a,n){var i=this,r=i.config,o=i.loopTroughFields(a,e,t),s=o[0],c=o[1];s.length&&confirm(r.overwriteConfirmHeader+c.join("\n"))&&s.forEach(function(a){var n=e.find('[name="'+a+'"]');i.fillField(n,t[a])}),i.loopTroughFormSets(n,e,t)},loopTroughFields:function(e,t,a){var i=this,r=i.config,o=[],s=[],c=!1;return e.forEach(function(e){var r=t.find('[name="'+e+'"]');if(("hidden"==r.attr("type")||r.parent().hasClass("hide"))&&(r.val(""),a[e]&&(c=!0)),a[e]&&r.val()!==n)if(r.val().length&&r.val()!==r.attr("placeholder")){var l=r.parents(".form-group").find("label").text();o.push(e),s.push("- "+l)}else i.fillField(r,a[e])}),c&&toastr.success(r.hiddenSuccessText,r.hiddenSuccessHeader),[o,s]},loopTroughFormSets:function(t,a,n){for(var i=0;i<t.length;i++){var r=t[i];if(n[r]&&n[r].length)for(var o,s=a.find("#"+r),c=s.find("[data-formset-add]"),l=n[r],u=0;u<l.length;u++){var d,m=l[u],f=!1;if("object"==typeof m){var p,g=!1;for(p in m)o=s.find(':input[name$="'+p+'"]'),o.length&&(g=!0,o=o.filter(function(){var t=e(this).val(),a=m[p];return""===t&&null===a||t==a}),o.length||(f=!0));if(f||!g){c.click(),d=s.find("[data-formset-body] [data-formset-form]:last");for(p in m)d.find(':input[name$="'+p+'"]').val(m[p])}}else"string"==typeof m&&(o=s.find(":input").filter(function(){return e(this).val()==m}),o.length||(c.click(),d=s.find("[data-formset-body] [data-formset-form]:last"),d.find(":input:first").val(m)))}}},fillField:function(e,t){if("string"==typeof t)e.val(t);else if("string"==typeof t[0]){var a=t.concat(e.val().split(",")).filter(function(e,t,a){return a.indexOf(e)===t&&""!==e});e.val(a.join())}else e.val(JSON.stringify(t));e.change(),e.parent().hasClass("original-form-widget")&&e.parent().hasClass("hide")&&e.parents(".show-and-hide-input").find('a[data-action="show"]').trigger("click")}}}(jQuery,window,document)}(angular),function(e){"use strict";function t(e){e.state("base.accounts.detail.delete",{url:"/delete",views:{"@":{controller:"AccountDeleteController"}}})}function a(e,t,a){var n=t.id;a["delete"]({id:n},function(){e.go("base.accounts")},function(t){e.go("base.accounts")})}e.module("app.accounts").config(t),t.$inject=["$stateProvider"],e.module("app.accounts").controller("AccountDeleteController",a),a.$inject=["$state","$stateParams","Account"]}(angular),function(e){"use strict";function t(e){e.state("base.accounts.detail",{url:"/{id:[0-9]{1,}}",views:{"@":{templateUrl:"accounts/controllers/detail.html",controller:a}},ncyBreadcrumb:{label:"{{ account.name }}"},resolve:{account:["AccountDetail","$stateParams",function(e,t){var a=t.id;return e.get({id:a}).$promise}]}})}function a(e,t,a,n,i,r){var o=t.id;e.account=r,e.conf.pageTitleBig=r.name,e.conf.pageTitleSmall="change is natural",e.caseList=a.query({filterquery:"account:"+o}),e.caseList.$promise.then(function(t){e.caseList=t}),e.dealList=i.query({filterquery:"account:"+o}),e.dealList.$promise.then(function(t){e.dealList=t}),e.contactList=n.query({filterquery:"accounts.id:"+o}),e.contactList.$promise.then(function(t){e.contactList=t})}e.module("app.accounts").config(t),t.$inject=["$stateProvider"],e.module("app.accounts").controller("AccountDetailController",a),a.$inject=["$scope","$stateParams","CaseDetail","ContactDetail","DealDetail","account"]}(angular),function(e){"use strict";function t(e){e.state("base.accounts",{url:"/accounts",views:{"@":{templateUrl:"accounts/controllers/list.html",controller:a,controllerAs:"vm"}},ncyBreadcrumb:{label:"Accounts"}})}function a(t,a,n,i){function r(){l()}function o(e){confirm("Are you sure?")&&n["delete"]({id:e.id},function(){var t=m.table.items.indexOf(e);m.table.items.splice(t,1)},function(e){alert("something went wrong.")})}function s(){f.put("filter",m.table.filter),f.put("order",m.table.order),f.put("visibility",m.table.visibility)}function c(){n.getAccounts(m.table.filter,m.table.page,m.table.pageSize,m.table.order.column,m.table.order.ascending).then(function(e){m.table.items=e.accounts,m.table.totalItems=e.total})}function l(){t.$watchGroup(["vm.table.page","vm.table.order.column","vm.table.order.ascending","vm.table.filter"],function(){s(),c()}),t.$watchCollection("vm.table.visibility",function(){s()})}function u(e){m.table.filter=e}function d(){var t="";m.table.filter&&(t+="&export_filter="+m.table.filter),e.forEach(m.table.visibility,function(e,a){e&&(t+="&export_columns="+a)});var n="/accounts/export/";t&&(n+="?"+t.substr(1)),a.open(n)}var m=this,f=i("accountList");m.table={page:1,pageSize:20,totalItems:0,filter:f.get("filter",""),order:f.get("order",{ascending:!0,column:"modified"}),visibility:f.get("visibility",{name:!0,contactInformation:!0,assignedTo:!0,created:!0,modified:!0,tags:!0,customerId:!0})},m.deleteAccount=o,
m.setFilter=u,m.exportToCsv=d,r(),t.conf.pageTitleBig="Accounts",t.conf.pageTitleSmall="An overview of accounts"}e.module("app.accounts").config(t),t.$inject=["$stateProvider"],e.module("app.accounts").controller("AccountList",a),a.$inject=["$scope","$window","Account","Cookie"]}(angular),function(e){"use strict";function t(e){e.state("base.accounts.create",{url:"/create",views:{"@":{templateUrl:"/accounts/create/",controller:"AccountUpsertController"}},ncyBreadcrumb:{label:"Create"}}),e.state("base.accounts.detail.edit",{url:"/edit",views:{"@":{templateUrl:function(e){return"/accounts/"+e.id+"/edit/"},controller:"AccountUpsertController"}},ncyBreadcrumb:{label:"Edit"}})}function a(e,t,a){var n=t.id;if(n){var i=a.get({id:n}).$promise;i.then(function(t){e.account=t,e.conf.pageTitleBig=t.name,e.conf.pageTitleSmall="change is natural",HLSelect2.init()})}else e.conf.pageTitleBig="New Account",e.conf.pageTitleSmall="change is natural";HLDataProvider.init(),HLFormsets.init()}e.module("app.accounts").config(t),t.$inject=["$stateProvider"],e.module("app.accounts").controller("AccountUpsertController",a),a.$inject=["$scope","$stateParams","AccountDetail"]}(angular),function(e){"use strict";function t(){return{restrict:"E",replace:!0,scope:{account:"=",height:"="},templateUrl:"accounts/directives/detail_widget.html"}}e.module("app.accounts.directives").directive("accountDetailWidget",t)}(angular),function(e){"use strict";function t(e){e.state("base",{"abstract":!0,controller:a,ncyBreadcrumb:{label:"Lily"}})}function a(t,a,n){function i(){t.$on("$stateChangeSuccess",s),t.$on("$viewContentLoaded",o)}function r(){n.query(function(t){e.forEach(t,function(e){toastr[e.level](e.message)})},function(e){console.log("error!"),console.log(e)})}function o(){Metronic.initComponents(),HLSelect2.init(),HLFormsets.init(),HLShowAndHide.init(),autosize($("textarea")),t.loadNotifications()}function s(e,n,i,r,o){t.previousState=a.href(r,o)}t.conf={headTitle:"Welcome!",pageTitleBig:"HelloLily",pageTitleSmall:"welcome to my humble abode!"},t.loadNotifications=r,i()}e.module("app.base").config(t),t.$inject=["$stateProvider"],e.module("app.base").controller("BaseController",a),a.$inject=["$scope","$state","Notifications"]}(angular),function(e){"use strict";function t(e){e.$on("$includeContentLoaded",function(){Layout.initHeader()})}e.module("app.base").controller("headerController",t),t.$inject=["$scope"]}(angular),function(e){"use strict";function t(e){e.$on("$includeContentLoaded",function(){Layout.initSidebar()})}e.module("app.base").controller("sidebarController",t),t.$inject=["$scope"]}(angular),function(e){"use strict";function t(){return{restrict:"E",replace:!0,transclude:!0,scope:{model:"="},templateUrl:"base/directives/checkbox.html"}}e.module("app.directives").directive("checkbox",t)}(angular),function(e){"use strict";function t(e){return{restrict:"A",require:"ngModel",link:function(t,a,n,i){i.$formatters.push(function(t){return t?e(t,n.dateFormatter):void 0})}}}e.module("app.directives").directive("dateFormatter",t),t.$inject=["dateFilter"]}(angular),function(e){"use strict";function t(e){return{restrict:"A",link:function(t,a,n){$(a).click(function(){confirm("You are deleting! Are you sure ?")&&e.go(".delete")})}}}e.module("app.directives").directive("detailDelete",t),t.$inject=["$state"]}(angular),function(e){"use strict";function t(){return{restrict:"A",link:function(e,t,a){var n=$("body").outerHeight();t.on("load",function(){t.removeClass("hidden");var e,a=this;try{e=a.contentWindow.document.documentElement}catch(i){try{e=a.contentDocument.documentElement}catch(r){}}if(e){var o=[t.offset().top,$(".footer").outerHeight(),$(".inbox-attached").outerHeight()];for(var s in o)n-=s;a.height=e.scrollHeight>n?n:e.scrollHeight}})}}}e.module("app.directives").directive("resizeIframe",t)}(angular),function(e){"use strict";function t(){var e=function(e,t,a){e.sorted=e.table.order.column===a?e.table.order.ascending?1:-1:0};return{restrict:"A",scope:{table:"="},transclude:!0,templateUrl:"base/directives/sort_column.html",link:function(t,a,n){t.$watchCollection("table.order",function(){e(t,a,n.sortColumn)}),a.on("click",function(){t.table.order.column===n.sortColumn?(t.table.order.ascending=!t.table.order.ascending,t.$apply()):(t.table.order.column=n.sortColumn,t.$apply())})}}}e.module("app.directives").directive("sortColumn",t)}(angular),function(e){"use strict";function t(e){return{link:function(t,a,n){a.addClass("hide"),e.$on("$stateChangeStart",function(){a.removeClass("hide")}),e.$on("$stateChangeSuccess",function(){a.addClass("hide"),$("body").removeClass("page-on-load"),setTimeout(function(){Metronic.scrollTop()},e.settings.layout.pageAutoScrollOnLoad)}),e.$on("$stateNotFound",function(){a.addClass("hide")}),e.$on("$stateChangeError",function(){a.addClass("hide")})}}}e.module("app.directives").directive("ngSpinnerBar",t),t.$inject=["$rootScope"]}(angular),function(e){"use strict";function t(){return function(e){return e.sort(function(e,t){return e-t}),e[0]}}e.module("app.filters").filter("minValue",t)}(angular),function(e){"use strict";function t(e){return function(t,a){var a=a||!0,n=a?"<br />":"<br>",t=(t+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1"+n+"$2");return e.trustAsHtml(t)}}e.module("app.filters").filter("nl2br",t),t.$inject=["$sce"]}(angular),function(e){"use strict";function t(e){return function(t,a,n){var i,r,o,s,c,l,u,d,m=new Date;if(t instanceof Date||(t=new Date(t),n&&(t.setHours(23),t.setMinutes(59),t.setSeconds(59))),o=null,c=60,s=60*c,r=24*s,l=7*r,u=30*r,d=365*r,i=function(){return o=Math.round((t-m)/1e3)},i(),o>r&&l>o&&(t=new Date(t.getFullYear(),t.getMonth(),t.getDate()),n&&(t.setHours(23),t.setMinutes(59),t.setSeconds(59)),i()),a||(a=window.innerWidth<992?"dd MMM. yyyy":"dd MMMM yyyy"),0>o)switch(!1){case!(-o>l):return e("date")(t,a);case!(-o>2*r):return""+-Math.ceil(o/r)+" days ago";case!(-o>r):return"yesterday";case!(-o>s):return""+-Math.ceil(o/s)+" hours ago";case!(-o>2*c):return""+-Math.ceil(o/c)+" minutes ago";case!(-o>c):return"a minutes ago";case!(-o>30):return""+-o+" seconds ago";default:return"just now"}else switch(!1){case!(30>o):return"just now";case!(c>o):return""+o+" seconds";case!(2*c>o):return"a minute";case!(s>o):return""+Math.floor(o/c)+" minutes";case 1!==Math.floor(o/s):return"an hour";case!(r>o):return""+Math.floor(o/s)+" hours";case!(2*r>o):return"tomorrow";case!(l>o):return""+Math.floor(o/r)+" days";case 1!==Math.floor(o/l):return"a week";default:return e("date")(t,a)}}}e.module("app.filters").filter("relativeDate",t),t.$inject=["$filter"]}(angular),function(e){"use strict";function t(e){return function(t){return e.trustAsResourceUrl(t)}}e.module("app.filters").filter("trustAsResourceUrl",t),t.$inject=["$sce"]}(angular),function(e){"use strict";function t(e){function t(e){return new a(e)}function a(e){this.prefix=e}return a.prototype.get=function(t,a){try{var n=e.get(this.prefix+t);return void 0!==n?n:a}catch(i){return e.remove(this.prefix+t),a}},a.prototype.put=function(t,a){e.put(this.prefix+t,a)},t}e.module("app.services").service("Cookie",t),t.$inject=["$cookieStore"]}(angular),function(e){"use strict";function t(){this.getSubtractedDate=function(e){var t=new Date;return t.setDate(t.getDate()-e),t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()}}e.module("app.services").service("HLDate",t)}(angular),function(e){"use strict";function t(){this.updateFilterQuery=function(e){e.table.filterQuery="",e.displayFilterClear=!1;for(var t=[],a=0;a<e.filterList.length;a++){var n=e.filterList[a];n.id&&"archived"==n.id?n.selected?e.displayFilterClear=!0:t.push("archived:false"):n.selected&&(t.push(n.value),e.displayFilterClear=!0)}e.table.filterQuery=t.join(" AND ")},this.clearFilters=function(e){for(var t=0;t<e.filterList.length;t++)e.filterList[t].selected=!1;e.updateFilterQuery()}}e.module("app.services").service("HLFilters",t)}(angular),function(e){"use strict";function t(){String.prototype.hlCapitalize=function(){var e=this.toLowerCase();return e.charAt(0).toUpperCase()+e.substring(1)}}e.module("app.services").service("HLText",t)}(angular),function(e){"use strict";function t(e){return e("/api/utils/notifications/")}e.module("app.services").factory("Notifications",t),t.$inject=["$resource"]}(angular),function(e){"use strict";function t(e,t,a,n){function i(){r()}function r(){n.query({},function(e){c.users=e})}function o(){a.update({id:c.myCase.id,assigned_to:c.currentAssigneeId}).$promise.then(function(){e.close()})}function s(){e.dismiss("cancel")}var c=this;c.myCase=t,c.currentAssigneeId=t.assigned_to_id,c.users=[],c.ok=o,c.cancel=s,i()}e.module("app.cases").controller("CaseAssignModal",t),t.$inject=["$modalInstance","myCase","Case","User"]}(angular),function(e){"use strict";function t(e){e.state("base.cases.create",{url:"/create",views:{"@":{templateUrl:"/cases/create",controller:a}},ncyBreadcrumb:{label:"Create"}}),e.state("base.cases.create.fromContact",{url:"/contact/{id:[0-9]{1,}}",views:{"@":{templateUrl:function(e,t){return"/cases/create/from_contact/"+e.id+"/"},controller:a}},ncyBreadcrumb:{skip:!0}}),e.state("base.cases.create.fromAccount",{url:"/account/{id:[0-9]{1,}}",views:{"@":{templateUrl:function(e,t){return"/cases/create/from_account/"+e.id+"/"},controller:a}},ncyBreadcrumb:{skip:!0}})}function a(e){e.conf.pageTitleBig="New case",e.conf.pageTitleSmall="making cases",HLCases.addAssignToMeButton(),HLSelect2.init()}e.module("app.cases").config(t),t.$inject=["$stateProvider"],e.module("app.cases").controller("CaseCreateController",a),a.$inject=["$scope"]}(angular),function(e){"use strict";function t(e){e.state("base.cases.detail.delete",{url:"/delete",views:{"@":{controller:a}}})}function a(e,t,a){var n=a.id,i={method:"POST",url:"/cases/delete/"+n+"/",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}};e(i).success(function(e,a,n,i){t.go("base.cases")}).error(function(e,a,n,i){t.go("base.cases")})}e.module("app.cases").config(t),t.$inject=["$stateProvider"],e.module("app.cases").controller("CaseDeleteController",a),a.$inject=["$http","$state","$stateParams"]}(angular),function(e){"use strict";function t(e){e.state("base.cases.detail",{url:"/{id:[0-9]{1,}}",views:{"@":{templateUrl:"cases/controllers/detail.html",controller:a,controllerAs:"vm"}},ncyBreadcrumb:{label:"{{ case.subject }}"}})}function a(e,t,a,n,i,r,o){function s(){if(f["case"].is_archived)return"label-default";switch(f["case"].priority){case 0:return"label-success";case 1:return"label-info";case 2:return"label-warning";case 3:return"label-danger";default:return"label-info"}}function c(t){var a={method:"POST",url:"/cases/update/status/"+f["case"].id+"/",data:"status="+t,headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}};e(a).success(function(e,t,a,n){f["case"].status=e.status}).error(function(e,t,a,n){})}function l(){var t="";f["case"].assigned_to_id!=currentUser.id&&(t=currentUser.id);var a={method:"POST",url:"/cases/update/assigned_to/"+f["case"].id+"/",data:"assignee="+t,headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}};e(a).success(function(e,t,a,n){e.assignee?(f["case"].assigned_to_id=e.assignee.id,f["case"].assigned_to_name=e.assignee.name):(f["case"].assigned_to_id=null,f["case"].assigned_to_name=null)}).error(function(e,t,a,n){})}function u(t){var a={method:"POST",url:"/cases/archive/",data:"id="+t,headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}};e(a).success(function(e,t,a,n){f["case"].archived=!0}).error(function(e,t,a,n){})}function d(t){var a={method:"POST",url:"/cases/unarchive/",data:"id="+t,headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}};e(a).success(function(e,t,a,n){f["case"].archived=!1}).error(function(e,t,a,n){})}function m(e){var a=t.open({templateUrl:"cases/controllers/postpone.html",controller:"CasePostponeModal",controllerAs:"vm",size:"sm",resolve:{myCase:function(){return e}}});a.result.then(function(){n.go(n.current,{},{reload:!0})})}var f=this;a.conf.pageTitleBig="Case",a.conf.pageTitleSmall="the devil is in the details";var p=i.id;f["case"]=r.get({id:p}),f.caseStatuses=o.query(),f.getPriorityDisplay=s,f.changeCaseStatus=c,f.assignCase=l,f.archive=u,f.unarchive=d,f.openPostponeWidget=m}e.module("app.cases").config(t),t.$inject=["$stateProvider"],e.module("app.cases").controller("CaseDetailController",a),a.$inject=["$http","$modal","$scope","$state","$stateParams","CaseDetail","CaseStatuses"]}(angular),function(e){"use strict";function t(e){e.state("base.cases.detail.edit",{url:"/edit",views:{"@":{templateUrl:function(e,t){return"/cases/update/"+e.id+"/"},controller:a}},ncyBreadcrumb:{label:"Edit"}})}function a(e,t,a){var n=t.id,i=a.get({id:n}).$promise;i.then(function(t){e["case"]=t,e.conf.pageTitleBig=t.subject,e.conf.pageTitleSmall="change is natural",HLSelect2.init()})}e.module("app.cases").config(t),t.$inject=["$stateProvider"],e.module("app.cases").controller("CaseEditController",a),a.$inject=["$scope","$stateParams","CaseDetail"]}(angular),function(e){"use strict";function t(e){e.state("base.cases",{url:"/cases",views:{"@":{templateUrl:"cases/controllers/list.html",controller:a}},ncyBreadcrumb:{label:"Cases"}})}function a(e,t,a,n,i,r,o,s,c){function l(){var e=m.get("filterList",null);if(e)n.filterList=e;else{var t=[{name:"Assigned to me",value:"assigned_to_id:"+n.currentUser.id,selected:!1},{name:"Assigned to nobody",value:"NOT(assigned_to_id:*)",selected:!1},{name:"Expired 7 days or more ago",value:"expires:[* TO "+s.getSubtractedDate(7)+"]",selected:!1},{name:"Expired 30 days or more ago",value:"expires:[* TO "+s.getSubtractedDate(30)+"]",selected:!1},{name:"Archived",value:"",selected:!1,id:"archived"}];n.filterList=t,r.getCaseTypes().then(function(e){for(var a in e)e.hasOwnProperty(a)&&t.push({name:"Case type "+e[a],value:"casetype_id:"+a,selected:!1});n.filterList=t,u()})}}function u(){m.put("searchQuery",n.table.searchQuery),m.put("archived",n.table.archived),m.put("order",n.table.order),m.put("visibility",n.table.visibility),m.put("filterList",n.filterList)}function d(){r.getCases(n.table.searchQuery,n.table.page,n.table.pageSize,n.table.order.column,n.table.order.ascending,n.table.archived,n.table.filterQuery).then(function(e){n.table.items=e.cases,n.table.totalItems=e.total})}var m=o("caseList");n.conf.pageTitleBig="Cases",n.conf.pageTitleSmall="do all your lookin' here";var f="",p=t.search().search;f=void 0!=p?p:m.get("searchQuery",""),n.table={page:1,pageSize:60,totalItems:0,searchQuery:f,archived:m.get("archived",!1),order:m.get("order",{ascending:!0,column:"expires"}),visibility:m.get("visibility",{caseId:!0,client:!0,subject:!0,priority:!0,type:!0,status:!0,expires:!0,assignedTo:!0,createdBy:!0,tags:!0})},n.displayFilterClear=!1,l(),n.$watchGroup(["table.page","table.order.column","table.order.ascending","table.searchQuery","table.archived","table.filterQuery"],function(){u(),d()}),n.$watchCollection("table.visibility",function(){u()}),n.$watchCollection("filterList",function(){n.updateFilterQuery()}),n.setSearchQuery=function(e){n.table.searchQuery=e},n.toggleArchived=function(){n.table.archived=!n.table.archived},n.updateFilterQuery=function(){c.updateFilterQuery(n)},n.clearFilters=function(){c.clearFilters(n)},n["delete"]=function(t,a,i){var r={method:"POST",url:"/cases/delete/"+t+"/",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}};confirm("Are you sure you want to delete case "+a+"?")&&e(r).success(function(e,t,a,r){var o=n.table.items.indexOf(i);n.table.items.splice(o,1)}).error(function(e,t,a,n){})},n.assignTo=function(e){var t=a.open({templateUrl:"cases/controllers/assignto.html",controller:"CaseAssignModal",controllerAs:"vm",size:"sm",resolve:{myCase:function(){return e}}});t.result.then(function(){i.go(i.current,{},{reload:!0})})}}e.module("app.cases").config(t),t.$inject=["$stateProvider"],e.module("app.cases").controller("CaseListController",a),a.$inject=["$http","$location","$modal","$scope","$state","Case","Cookie","HLDate","HLFilters"]}(angular),function(e){"use strict";function t(e,t,a,n,i){function r(){o()}function o(){a.$watch("vm.pickerIsOpen",function(e,t){!e&&t&&s()})}function s(){if(m.expireDate!=new Date(i.expires)){var a=e("date")(m.expireDate,"yyyy-MM-dd");n.update({id:i.id},{expires:a},function(){t.close()})}else t.close()}function c(e,t){return"day"===t&&(0===e.getDay()||6===e.getDay())}function l(e){e.preventDefault(),e.stopPropagation(),m.pickerIsOpen=!0}function u(e){m.expireDate.setDate(m.expireDate.getDate()+e),s()}function d(e){var t=new Date(m.expireDate);return t.setDate(t.getDate()+e)}var m=this;m.myCase=i,m.pickerIsOpen=!1,m.expireDate=new Date(i.expires),m.dateFormat="dd MMMM yyyy",m.datepickerOptions={startingDay:1},m.disabledDates=c,m.openDatePicker=l,m.postponeWithDays=u,m.getFutureDate=d,r()}e.module("app.cases").controller("CasePostponeModal",t),t.$inject=["$filter","$modalInstance","$scope","Case","myCase"]}(angular),function(e){"use strict";function t(){return{restrict:"E",replace:!0,scope:{title:"@",list:"=",height:"=",addLink:"@"},templateUrl:"cases/directives/list_widget.html"}}e.module("app.cases.directives").directive("caseListWidget",t)}(angular),function(e){"use strict";function t(){return{restrict:"A",link:function(e,t,a){var n=$("#id_priority"),i=[5,3,1,0];n.on("change",function(e){var t=parseInt(n.val());isNaN(n.val())&&(t=3);var a=addBusinessDays(new Date,i[t]),r=a.getMonth()+1;10>r&&(r="0"+r);var o=a.getDate()+"/"+r+"/"+a.getFullYear();$("#id_expires").val(o),$("#id_expires_picker").datepicker("update",o)})}}}e.module("app.cases.directives").directive("updateCaseExpireDate",t)}(angular),function(e){"use strict";function t(t,a,n,i,r){function o(e,a,n,i,r,o,s){return t({url:"/search/search/",method:"GET",params:{type:"cases_case",q:e,page:a-1,size:n,sort:c(i,r),filterquery:s}}).then(function(e){return{cases:e.data.hits,total:e.data.total}})}function s(){return t({url:"/cases/casetypes/",method:"GET"}).then(function(e){return e.data.casetypes})}function c(e,t){var a="";return a+=t?"-":"",a+=e}function l(e,t){var a=n.defer(),i="archived:false AND NOT casetype_name:Callback";return i+=" AND assigned_to_id:"+currentUser.id,m.query({filterquery:i,sort:c(e,t)},function(e){a.resolve(e)}),a.promise}function u(t,a){var o="archived:false AND casetype_name:Callback";o+=" AND assigned_to_id:"+currentUser.id;var s=n.defer();return m.query({filterquery:o,sort:c(t,a)},function(t){e.forEach(t,function(e){e.account&&i.get({id:e.account},function(t){e.accountPhone=t.phone}),e.contact&&r.get({id:e.contact},function(t){e.contactPhone=t.phone})}),s.resolve(t)}),s.promise}function d(e,t,a){var n="archived:false AND _missing_:assigned_to_id";return n+=" AND assigned_to_groups:"+e,m.query({filterquery:n,sort:c(t,a)}).$promise}var m=a("/api/cases/case/:id",{},{query:{url:"/search/search/?type=cases_case&filterquery=:filterquery",isArray:!0,transformResponse:function(t){t=e.fromJson(t);var a=[];return t&&t.hits&&t.hits.length>0&&t.hits.forEach(function(e){a.push(e)}),a}},update:{method:"PATCH",params:{id:"@id"}}});return m.getCases=o,m.getCaseTypes=s,m.getMyCasesWidget=l,m.getCallbackRequests=u,m.getUnassignedCasesForTeam=d,m}e.module("app.cases.services").factory("Case",t),t.$inject=["$http","$resource","$q","AccountDetail","ContactDetail"]}(angular),function(e){"use strict";function t(t){return t("/search/search/?type=cases_case&filterquery=id::id",{},{get:{transformResponse:function(t){if(t=e.fromJson(t),t&&t.hits&&t.hits.length>0){var a=t.hits[0];return a}return null}},query:{url:"/search/search/?type=cases_case&filterquery=:filterquery",isArray:!0,transformResponse:function(t){t=e.fromJson(t);var a=[];return t&&t.hits&&t.hits.length>0&&t.hits.forEach(function(e){e=$.extend(e,{historyType:"case",color:"grey",date:e.expires}),a.push(e)}),a}},totalize:{url:"/search/search/?type=cases_case&size=0&filterquery=:filterquery",transformResponse:function(t){return t=e.fromJson(t),t&&t.total?{total:t.total}:{total:0}}}})}e.module("app.cases.services").factory("CaseDetail",t),t.$inject=["$resource"]}(angular),function(e){"use strict";function t(e){return e("/api/cases/statuses")}e.module("app.cases.services").factory("CaseStatuses",t),t.$inject=["$resource"]}(angular),function(e){"use strict";function t(e){return e("/api/cases/teams/:teamId/?is_assigned=False&is_archived=false&is_deleted=False")}e.module("app.cases.services").factory("UnassignedTeamCases",t),t.$inject=["$resource"]}(angular),function(e){"use strict";function t(e){e.state("base.contacts.create",{url:"/create",views:{"@":{templateUrl:"contacts/create/",controller:a}},ncyBreadcrumb:{label:"Create"}}),e.state("base.contacts.create.fromAccount",{url:"/account/{id:[0-9]{1,}}",views:{"@":{templateUrl:function(e,t){return"/contacts/add/from_account/"+e.id+"/"},controller:a}},ncyBreadcrumb:{skip:!0}})}function a(e){e.conf.pageTitleBig="New contact",e.conf.pageTitleSmall="who did you talk to?"}e.module("app.contacts").config(t),t.$inject=["$stateProvider"],e.module("app.contacts").controller("ContactCreateController",a),a.$inject=["$scope"]}(angular),function(e){"use strict";function t(e){e.state("base.contacts.detail.delete",{url:"/delete",views:{"@":{controller:a}}})}function a(e,t,a){var n=t.id;a["delete"]({id:n},function(){e.go("base.contacts")},function(t){e.go("base.contacts")})}e.module("app.contacts").config(t),t.$inject=["$stateProvider"],e.module("app.contacts").controller("ContactDeleteController",a),a.$inject=["$state","$stateParams","ContactTest"]}(angular),function(e){"use strict";function t(e){e.state("base.contacts.detail",{url:"/{id:[0-9]{1,}}",views:{"@":{templateUrl:"contacts/controllers/detail.html",controller:"ContactDetailController"}},ncyBreadcrumb:{label:"{{ contact.name }}"},resolve:{contact:["ContactDetail","$stateParams",function(e,t){var a=t.id;return e.get({id:a}).$promise}]}})}function a(e,t,a,n,i){var r=t.id;e.contact=i,e.contact.accounts&&e.contact.accounts.forEach(function(e){var t=a.query({filterquery:"NOT(id:"+r+") AND accounts.id:"+e.id});t.$promise.then(function(t){e.colleagueList=t})}),e.conf.pageTitleBig="Contact detail",e.conf.pageTitleSmall="the devil is in the details",e.caseList=n.query({filterquery:"contact:"+r}),e.caseList.$promise.then(function(t){e.caseList=t})}e.module("app.contacts").config(t),t.$inject=["$stateProvider"],e.module("app.contacts").controller("ContactDetailController",a),a.$inject=["$scope","$stateParams","ContactDetail","CaseDetail","contact"]}(angular),function(e){"use strict";function t(e){e.state("base.contacts.detail.edit",{url:"/edit",views:{"@":{templateUrl:function(e,t){return"/contacts/edit/"+e.id+"/"},controller:a}},ncyBreadcrumb:{label:"Edit"}})}function a(e,t,a){var n=t.id,i=a.get({id:n}).$promise;i.then(function(t){e.contact=t,e.conf.pageTitleBig=t.name,e.conf.pageTitleSmall="change is natural",HLSelect2.init()})}e.module("app.contacts").config(t),t.$inject=["$stateProvider"],e.module("app.contacts").controller("ContactEditController",a),a.$inject=["$scope","$stateParams","ContactDetail"]}(angular),function(e){"use strict";function t(e){e.state("base.contacts",{url:"/contacts",views:{"@":{templateUrl:"contacts/controllers/list.html",controller:a}},ncyBreadcrumb:{label:"Contacts"}})}function a(t,a,n,i,r){function o(){c.put("filter",t.table.filter),c.put("order",t.table.order),c.put("visibility",t.table.visibility)}function s(){n.query(t.table).then(function(e){t.table.items=e.contacts,t.table.totalItems=e.total})}var c=i("contactList");t.conf.pageTitleBig="Contacts",t.conf.pageTitleSmall="do all your lookin' here",t.table={page:1,pageSize:20,totalItems:0,filter:c.get("filter",""),order:c.get("order",{ascending:!0,column:"modified"}),visibility:c.get("visibility",{name:!0,contactInformation:!0,worksAt:!0,created:!0,modified:!0,tags:!0})},t.deleteContact=function(e){confirm("Are you sure?")&&r["delete"]({id:e.id},function(){var a=t.table.items.indexOf(e);t.table.items.splice(a,1)},function(e){alert("something went wrong.")})},t.$watchGroup(["table.page","table.order.column","table.order.ascending","table.filter"],function(){o(),s()}),t.$watchCollection("table.visibility",function(){o()}),t.setFilter=function(e){t.table.filter=e},t.exportToCsv=function(){var n="";t.table.filter&&(n+="&export_filter="+t.table.filter),e.forEach(t.table.visibility,function(e,t){e&&(n+="&export_columns="+t)});var i="/contacts/export/";n&&(i+="?"+n.substr(1)),a.open(i)}}e.module("app.contacts").config(t),t.$inject=["$stateProvider"],e.module("app.contacts").controller("ContactListController",a),a.$inject=["$scope","$window","Contact","Cookie","ContactTest"]}(angular),function(e){"use strict";function t(){return{restrict:"E",replace:!0,scope:{contact:"=",height:"="},templateUrl:"contacts/directives/detail_widget.html"}}e.module("app.contacts.directives").directive("contactDetailWidget",t)}(angular),function(e){"use strict";function t(){return{restrict:"E",replace:!0,scope:{title:"@",list:"=",height:"=",accountId:"@",addLink:"@"},templateUrl:"contacts/directives/list_widget.html"}}e.module("app.contacts.directives").directive("contactListWidget",t)}(angular),function(e){"use strict";function t(t){function a(e){return e.phone_mobile?e.phone_mobile[0]:e.phone_work?e.phone_work[0]:e.phone_other?e.phone_other[0]:""}function n(e){var t=[];return e.phone_mobile&&(t=t.concat(e.phone_mobile)),e.phone_work&&(t=t.concat(e.phone_work)),e.phone_other&&(t=t.concat(e.phone_other)),t}return t("/search/search/?type=contacts_contact&filterquery=id::id",{},{get:{transformResponse:function(t){if(t=e.fromJson(t),t&&t.hits&&t.hits.length>0){var i=t.hits[0];return i.phones=n(i),i.phone=a(i),i}return null}},query:{url:"/search/search/?type=contacts_contact&size=1000&filterquery=:filterquery",isArray:!0,transformResponse:function(t){t=e.fromJson(t);var i=[];return t&&t.hits&&t.hits.length>0&&t.hits.forEach(function(e){e.phones=n(e),e.phone=a(e),i.push(e)}),i}}})}e.module("app.contacts.services").factory("ContactDetail",t),t.$inject=["$resource"]}(angular),function(e){"use strict";function t(e){var t={},a=function(t,a,n,i,r){var o="";return r&&(o+="-"),o+=i,e({url:"/search/search/",method:"GET",params:{type:"contacts_contact",q:t,page:a-1,size:n,sort:o}}).then(function(e){return{contacts:e.data.hits,total:e.data.total}})};return t.query=function(e){return a(e.filter,e.page,e.pageSize,e.order.column,e.order.ascending)},t}e.module("app.contacts.services").factory("Contact",t),t.$inject=["$http"]}(angular),function(e){"use strict";function t(e){return e("/api/contacts/contact/:id/")}e.module("app.contacts.services").factory("ContactTest",t),t.$inject=["$resource"]}(angular),function(e){"use strict";function t(e){e.state("base.dashboard",{url:"/",views:{"@":{templateUrl:"dashboard/controllers/base.html",controller:a,controllerAs:"vm"}},ncyBreadcrumb:{label:"Dashboard"}})}function a(e){e.conf.pageTitleBig="Dashboard",e.conf.pageTitleSmall="statistics and usage"}e.module("app.dashboard").config(t),t.$inject=["$stateProvider"],e.module("app.dashboard").controller("DashboardController",a),a.$inject=["$scope"]}(angular),function(e){"use strict";function t(){return{scope:{},templateUrl:"dashboard/directives/callback.html",controller:a,controllerAs:"vm"}}function a(e,t,a){function n(){r()}function i(){t.getCallbackRequests(o.table.order.column,o.table.order.ascending).then(function(e){o.table.items=e})}function r(){e.$watchGroup(["vm.table.order.ascending","vm.table.order.column"],function(){i(),s.put("order",o.table.order)})}var o=this,s=a("callbackWidget");o.table={order:s.get("order",{ascending:!0,column:"created"}),items:[]},n()}e.module("app.dashboard.directives").directive("callbackRequests",t),a.$inject=["$scope","Case","Cookie"]}(angular),function(e){"use strict";function t(){return{scope:{},templateUrl:"dashboard/directives/dealstocheck.html",controller:a,controllerAs:"vm"}}function a(t,a,n,i){function r(){c(),s()}function o(){d.table.selectedUserId&&n.getDealsToCheck(d.table.order.column,d.table.order.ascending,d.table.selectedUserId).then(function(e){d.table.items=e})}function s(){i.mine(function(t){e.forEach(t,function(e){d.users=d.users.concat(e.user_set)})})}function c(){t.$watchGroup(["vm.table.order.ascending","vm.table.order.column","vm.table.selectedUserId"],function(){o(),u.put("order",d.table.order),u.put("selectedUserId",d.table.selectedUserId)})}function l(e){e.markDealAsChecked().then(function(){d.table.items.splice(d.table.items.indexOf(e),1)})}var u=a("dealsToCheckkWidget"),d=this;d.users=[],d.table={order:u.get("order",{ascending:!0,column:"closing_date"}),items:[],selectedUserId:u.get("selectedUserId")},d.markDealAsChecked=l,r()}e.module("app.dashboard.directives").directive("dealsToCheck",t),a.$inject=["$scope","Cookie","Deal","UserTeams"]}(angular),function(e){"use strict";function t(){return{scope:{},templateUrl:"dashboard/directives/feedback.html",controller:a,controllerAs:"vm"}}function a(e,t,a,n,i){function r(){l()}function o(){i.getFeedbackDeals(d.table.order.column,d.table.order.ascending).then(function(e){d.table.items=e})}function s(e){e.feedbackFormSent().then(function(){d.table.items.splice(d.table.items.indexOf(e),1)})}function c(e){a.get({id:e.account},function(e){var a=e.getEmailAddress();a?t.go("base.email.composeEmail",{email:a.email_address}):t.go("base.email.compose")})}function l(){e.$watchGroup(["vm.table.order.ascending","vm.table.order.column"],function(){o(),u.put("order",d.table.order)})}var u=n("feedbackWidget"),d=this;d.table={order:u.get("order",{ascending:!0,column:"closing_date"}),items:[]},d.feedbackFormSentForDeal=s,d.openFeedbackForm=c,r()}e.module("app.dashboard.directives").directive("feedback",t),a.$inject=["$scope","$state","Account","Cookie","Deal"]}(angular),function(e){"use strict";function t(){return{scope:{},templateUrl:"dashboard/directives/followup.html",controller:a,controllerAs:"vm"}}function a(e,t,a,n){function i(){s()}function r(){a.getFollowUpWidgetData(l.table.order.column,l.table.order.ascending).then(function(e){l.table.items=e})}function o(t){var a=e.open({templateUrl:"deals/controllers/followup_widget.html",controller:"FollowUpWidgetModal",controllerAs:"vm",size:"md",resolve:{followUp:function(){return t}}});a.result.then(function(){r()})}function s(){t.$watchGroup(["vm.table.order.ascending","vm.table.order.column"],function(){r(),c.put("order",l.table.order)})}var c=n("followupWidget"),l=this;l.table={order:c.get("order",{ascending:!0,column:"created"}),items:[]},l.openFollowUpWidgetModal=o,i()}e.module("app.dashboard.directives").directive("followUp",t),a.$inject=["$modal","$scope","Deal","Cookie"]}(angular),function(e){"use strict";function t(){return{scope:{},templateUrl:"dashboard/directives/mycases.html",controller:a,controllerAs:"vm"}}function a(e,t,a,n){function i(){s()}function r(){a.getMyCasesWidget(l.table.order.column,l.table.order.ascending).then(function(e){l.table.items=e})}function o(t){var a=e.open({templateUrl:"cases/controllers/postpone.html",controller:"CasePostponeModal",controllerAs:"vm",size:"sm",resolve:{myCase:function(){return t}}});a.result.then(function(){r()})}function s(){t.$watchGroup(["vm.table.order.ascending","vm.table.order.column"],function(){r(),c.put("order",l.table.order)})}var c=n("myCasesWidget"),l=this;l.table={order:c.get("order",{ascending:!0,column:"expires"}),items:[]},l.openPostponeWidget=o,i()}e.module("app.dashboard.directives").directive("myCases",t),a.$inject=["$modal","$scope","Case","Cookie"]}(angular),function(e){"use strict";function t(){return{scope:{},templateUrl:"dashboard/directives/queuesize.html",controller:a}}function a(t,a,n,i){if(i.show=!1,i.currentUser=currentUser,currentUser.isSuperUser){i.labels=[],i.series=["Queue Size"],i.data=[[]],i.options={animation:!1},i.queueName="queue1";var r=function(){a.get("/api/utils/queues/"+i.queueName+"/").then(function(e){i.labels.push(t("date")(Date.now(),"H:mm:ss")),i.data[0].push(e.data.size),i.data[0].length>15&&(i.data[0].shift(),
i.labels.shift()),i.totalSize=e.data.total_messages,i.show=!0},function(){n.cancel(o),i.show=!1})};r();var o=n(r,1e4);i.$on("$destroy",function(){e.isDefined(o)&&(n.cancel(o),o=void 0)})}}e.module("app.dashboard.directives").directive("queueSize",t),a.$inject=["$filter","$http","$interval","$scope"]}(angular),function(e){"use strict";function t(){return{templateUrl:"dashboard/directives/teams.html",controller:a,controllerAs:"vm"}}function a(e){function t(){a()}function a(){e.mine(function(e){n.teams=e})}var n=this;n.teams=[],t()}e.module("app.dashboard.directives").directive("teams",t),a.$inject=["UserTeams"]}(angular),function(e){"use strict";function t(){return{templateUrl:"dashboard/directives/unassignedcases.html",controller:a,controllerAs:"vm",bindToController:!0,scope:{team:"="}}}function a(e,t,a,n){function i(){s()}function r(){a.getUnassignedCasesForTeam(c.team.id,c.table.order.column,c.table.order.ascending).then(function(e){c.table.items=e})}function o(a){if(confirm("Assign this case to yourself?")){var n={method:"POST",url:"/cases/update/assigned_to/"+a.id+"/",data:"assignee="+currentUser.id,headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}};e(n).success(function(){c.table.items.splice(c.table.items.indexOf(a),1),t.loadNotifications()})}}function s(){t.$watchGroup(["vm.table.order.ascending","vm.table.order.column"],function(){r(),l.put("order",c.table.order)})}var c=this,l=n("unassignedCasesForTeam"+c.team.id+"Widget");c.table={order:l.get("order",{ascending:!0,column:"id"}),items:[]},c.assignToMe=o,i()}e.module("app.dashboard.directives").directive("unassignedCases",t),a.$inject=["$http","$scope","Case","Cookie"]}(angular),function(e){"use strict";function t(){return{scope:{},templateUrl:"dashboard/directives/unreademail.html",controller:a,controllerAs:"vm"}}function a(e,t,a){function n(){r()}function i(){t.getDashboardMessages(s.table.order.column,s.table.order.ascending).then(function(e){s.table.items=e})}function r(){e.$watchGroup(["vm.table.order.ascending","vm.table.order.column"],function(){i(),o.put("order",s.table.order)})}var o=a("unreadEmailWidget"),s=this;s.table={order:o.get("order",{ascending:!0,column:"sent_date"}),items:[]},n()}e.module("app.dashboard.directives").directive("unreadEmail",t),a.$inject=["$scope","EmailMessage","Cookie"]}(angular),function(e){"use strict";function t(e){e.state("base.deals.create",{url:"/create",views:{"@":{templateUrl:"/deals/create",controller:a}},ncyBreadcrumb:{label:"New"}}),e.state("base.deals.create.fromAccount",{url:"/account/{id:[0-9]{1,}}",views:{"@":{templateUrl:function(e,t){return"/deals/create/from_account/"+e.id+"/"},controller:a}},ncyBreadcrumb:{skip:!0}})}function a(e){e.conf.pageTitleBig="New deal",e.conf.pageTitleSmall="making deals"}e.module("app.deals").config(t),t.$inject=["$stateProvider"],e.module("app.deals").controller("DealCreateController",a),a.$inject=["$scope"]}(angular),function(e){"use strict";function t(e){e.state("base.deals.detail.delete",{url:"/delete",views:{"@":{controller:a}}})}function a(e,t,a){var n=a.id,i={method:"POST",url:"/deals/delete/"+n+"/",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}};e(i).success(function(e,a,n,i){t.go("base.deals")}).error(function(e,a,n,i){t.go("base.deals")})}e.module("app.deals").config(t),t.$inject=["$stateProvider"],e.module("app.deals").controller("DealDeleteController",a),a.$inject=["$http","$state","$stateParams"]}(angular),function(e){"use strict";function t(e){e.state("base.deals.detail",{url:"/{id:[0-9]{1,}}",views:{"@":{templateUrl:"deals/controllers/detail.html",controller:a}},ncyBreadcrumb:{label:"{{ deal.name }}"}})}function a(e,t,a,n,i){t.conf.pageTitleBig="Deal detail",t.conf.pageTitleSmall="the devil is in the details";var r=a.id;t.deal=n.get({id:r}),t.dealStages=i.query(),t.changeState=function(a){var n=a,i={method:"POST",url:"/deals/update/stage/"+t.deal.id+"/",data:"stage="+a,headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}};e(i).success(function(e,a,i,r){t.deal.stage=n,t.deal.stage_name=e.stage,void 0!==e.closed_date&&(t.deal.closing_date=e.closed_date),t.loadNotifications()}).error(function(e,t,a,n){})},t.archive=function(a){var n={method:"POST",url:"/deals/archive/",data:"id="+a,headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}};e(n).success(function(e,a,n,i){t.deal.archived=!0}).error(function(e,t,a,n){})},t.unarchive=function(a){var n={method:"POST",url:"/deals/unarchive/",data:"id="+a,headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}};e(n).success(function(e,a,n,i){t.deal.archived=!1}).error(function(e,t,a,n){})}}e.module("app.deals").config(t),t.$inject=["$stateProvider"],e.module("app.deals").controller("DealDetailController",a),a.$inject=["$http","$scope","$stateParams","DealDetail","DealStages"]}(angular),function(e){"use strict";function t(e){e.state("base.deals.detail.edit",{url:"/edit",views:{"@":{templateUrl:function(e,t){return"/deals/update/"+e.id+"/"},controller:a}},ncyBreadcrumb:{label:"Edit"}})}function a(e,t,a){var n=t.id,i=a.get({id:n}).$promise;i.then(function(t){e.deal=t,e.conf.pageTitleBig="Edit "+t.name,e.conf.pageTitleSmall="change is natural"})}e.module("app.deals").config(t),t.$inject=["$stateProvider"],e.module("app.deals").controller("DealEditController",a),a.$inject=["$scope","$stateParams","DealDetail"]}(angular),function(e){"use strict";function t(e,t,a,n,i){function r(){o()}function o(){n.query({},function(e){u.dealStages=[];for(var t=0;t<e.length;t++)u.dealStages.push({id:e[t][0],name:e[t][1]})})}function s(){var n=e("date")(u.closingDate,"yyyy-MM-dd"),r=u.selectedStage.id;a.update({id:i.id},{stage:r,expected_closing_date:n},function(){t.close()})}function c(e){e.preventDefault(),e.stopPropagation(),u.pickerIsOpen=!0}function l(){t.close()}var u=this;u.dealStages=[],u.selectedStage={id:i.stage,name:i.stage_name},u.followUp=i,u.pickerIsOpen=!1,u.closingDate=new Date(i.closing_date),u.dateFormat="dd MMMM yyyy",u.datepickerOptions={startingDay:1},u.openDatePicker=c,u.saveModal=s,u.closeModal=l,r()}e.module("app.deals").controller("FollowUpWidgetModal",t),t.$inject=["$filter","$modalInstance","Deal","DealStages","followUp"]}(angular),function(e){"use strict";function t(e){e.state("base.deals",{url:"/deals",views:{"@":{templateUrl:"deals/controllers/list.html",controller:a}},ncyBreadcrumb:{label:"Deals"}})}function a(e,t,a,n,i,r,o){function s(){l.put("searchQuery",a.table.searchQuery),l.put("archived",a.table.archived),l.put("order",a.table.order),l.put("visibility",a.table.visibility),l.put("filterList",a.filterList)}function c(){i.getDeals(a.table.searchQuery,a.table.page,a.table.pageSize,a.table.order.column,a.table.order.ascending,a.table.filterQuery).then(function(e){a.table.items=e,a.table.totalItems=e.length?e[0].total_size:0})}var l=n("dealList");a.conf.pageTitleBig="Deals",a.conf.pageTitleSmall="do all your lookin' here";var u="",d=t.search().search;u=void 0!=d?d:l.get("searchQuery",""),a.table={page:1,pageSize:20,totalItems:0,searchQuery:u,filterQuery:"",archived:l.get("archived",!1),order:l.get("order",{ascending:!0,column:"closing_date"}),visibility:l.get("visibility",{deal:!0,stage:!0,created:!0,name:!0,amountOnce:!0,amountRecurring:!0,assignedTo:!0,closingDate:!0,feedbackFormSent:!0,newBusiness:!0,tags:!0})},a.filterList=l.get("filterList",[{name:"Assigned to me",value:"assigned_to_id:"+currentUser.id,selected:!1},{name:"New business",value:"new_business:true",selected:!1},{name:"Proposal stage",value:"stage:1",selected:!1},{name:"Won stage",value:"stage:2",selected:!1},{name:"Called",value:"stage:4",selected:!1},{name:"Emailed",value:"stage:5",selected:!1},{name:"Feedback form not sent",value:"feedback_form_sent:false",selected:!1},{name:"Age between 7 and 30 days",value:"created:["+r.getSubtractedDate(30)+" TO "+r.getSubtractedDate(7)+"]",selected:!1},{name:"Age between 30 and 120 days",value:"created:["+r.getSubtractedDate(120)+" TO "+r.getSubtractedDate(30)+"]",selected:!1},{name:"Archived",value:"",selected:!1,id:"archived"}]),a.$watchGroup(["table.page","table.order.column","table.order.ascending","table.searchQuery","table.archived","table.filterQuery"],function(){s(),c()}),a.$watchCollection("table.visibility",function(){s()}),a.$watchCollection("filterList",function(){a.updateFilterQuery()}),a.setSearchQuery=function(e){a.table.searchQuery=e},a.toggleArchived=function(){a.table.archived=!a.table.archived},a.updateFilterQuery=function(){o.updateFilterQuery(a)},a.clearFilters=function(){o.clearFilters(a)},a["delete"]=function(t,n,i){var r={method:"POST",url:"/deals/delete/"+t+"/",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}};confirm("Are you sure you want to delete deal "+n+"?")&&e(r).success(function(e,t,n,r){var o=a.table.items.indexOf(i);a.table.items.splice(o,1)}).error(function(e,t,a,n){})}}e.module("app.deals").config(t),t.$inject=["$stateProvider"],e.module("app.deals").controller("DealListController",a),a.$inject=["$http","$location","$scope","Cookie","Deal","HLDate","HLFilters"]}(angular),function(e){"use strict";function t(){return{restrict:"E",replace:!0,scope:{title:"@",list:"=",height:"=",addLink:"@"},templateUrl:"deals/directives/list_widget.html"}}e.module("app.deals.directives").directive("dealListWidget",t)}(angular),function(e){"use strict";function t(t){function a(e,t,a,n,i,r){var o="";return i&&(o+="-"),o+=n,c.query({q:e,page:t-1,size:a,sort:o,filterquery:r},function(e){return e.length?{deals:e,total:e[0].total_size}:void 0}).$promise}function n(e,t,n){var i="stage:2 AND is_checked:false";return n&&(i+=" AND assigned_to_id:"+n),a("",1,20,e,t,i)}function i(e,t){var n="stage:2 AND feedback_form_sent:false AND assigned_to_id:"+currentUser.id;return a("",1,20,e,t,n)}function r(e,t){var n="(stage: 0 OR stage: 1 OR stage: 4 OR stage: 5) AND assigned_to_id: "+currentUser.id;return a("",1,20,e,t,n)}function o(){var e=this;return e.feedback_form_sent=!0,e.$update()}function s(){var e=this;return e.is_checked=!0,e.$update()}var c=t("/api/deals/deal/:id",null,{update:{method:"PUT",params:{id:"@id"}},query:{url:"/search/search/",method:"GET",params:{type:"deals_deal"},isArray:!0,transformResponse:function(t){t=e.fromJson(t);var a=[];return t&&t.hits&&t.hits.length>0&&t.hits.forEach(function(e){e=$.extend(e,{historyType:"deal",color:"blue",date:e.modified,total_size:t.total}),a.push(e)}),a}}});return c.getDeals=a,c.getDealsToCheck=n,c.getFeedbackDeals=i,c.getFollowUpWidgetData=r,c.prototype.markDealAsChecked=s,c.prototype.feedbackFormSent=o,c}e.module("app.deals.services").factory("Deal",t),t.$inject=["$resource"]}(angular),function(e){"use strict";function t(t){return t("/search/search/?type=deals_deal&filterquery=id::id",{},{get:{transformResponse:function(t){if(t=e.fromJson(t),t&&t.hits&&t.hits.length>0){var a=t.hits[0];return a}return null}},query:{url:"/search/search/?type=deals_deal&filterquery=:filterquery",isArray:!0,transformResponse:function(t){t=e.fromJson(t);var a=[];return t&&t.hits&&t.hits.length>0&&t.hits.forEach(function(e){e=$.extend(e,{historyType:"deal",color:"blue",date:e.modified}),a.push(e)}),a}},totalize:{url:"/search/search/?type=deals_deal&size=0&filterquery=:filterquery",transformResponse:function(t){return t=e.fromJson(t),t&&t.total?{total:t.total}:{total:0}}}})}e.module("app.deals.services").factory("DealDetail",t),t.$inject=["$resource"]}(angular),function(e){"use strict";function t(e){return e("/api/deals/stages")}e.module("app.deals.services").factory("DealStages",t),t.$inject=["$resource"]}(angular),function(e){"use strict";function t(e,t){t.when("/email","/email/all/INBOX"),e.state("base.email",{url:"/email",views:{"@":{templateUrl:"email/controllers/base.html",controller:a,controllerAs:"vm"},"labelList@base.email":{templateUrl:"email/controllers/label_list.html",controller:"LabelListController",controllerAs:"vm"}},ncyBreadcrumb:{label:"Email"},resolve:{primaryEmailAccountId:["$q","User",function(e,t){var a=e.defer();return t.me(null,function(e){a.resolve(e.primary_email_account)}),a.promise}]}})}function a(e){e.conf.pageTitleBig="Email",e.conf.pageTitleSmall="sending love through the world!"}e.module("app.email").config(t),t.$inject=["$stateProvider","$urlRouterProvider"],e.module("app.email").controller("EmailBaseController",a),a.$inject=["$scope"]}(angular),function(e){"use strict";function t(e){e.state("base.email.compose",{url:"/compose",views:{"@base.email":{templateUrl:"/messaging/email/compose/",controller:a,controllerAs:"vm"}}}),e.state("base.email.composeEmail",{url:"/compose/{email}",views:{"@base.email":{templateUrl:"/messaging/email/compose/",controller:a,controllerAs:"vm"}}}),e.state("base.email.composeEmailTemplate",{url:"/compose/{email}/{template}",views:{"@base.email":{templateUrl:"/messaging/email/compose/",controller:a,controllerAs:"vm"}}}),e.state("base.email.draft",{url:"/draft/{id:[0-9]{1,}}",params:{messageType:"draft"},views:{"@base.email":{templateUrl:function(e,t){return"/messaging/email/draft/"+e.id+"/"},controller:a,controllerAs:"vm"}}}),e.state("base.email.reply",{url:"/reply/{id:[0-9]{1,}}",params:{messageType:"reply"},views:{"@base.email":{templateUrl:function(e,t){return"/messaging/email/reply/"+e.id+"/"},controller:a,controllerAs:"vm"}}}),e.state("base.email.replyAll",{url:"/replyall/{id:[0-9]{1,}}",params:{messageType:"reply-all"},views:{"@base.email":{templateUrl:function(e,t){return"/messaging/email/replyall/"+e.id+"/"},controller:a,controllerAs:"vm"}}}),e.state("base.email.forward",{url:"/forward/{id:[0-9]{1,}}",params:{messageType:"forward"},views:{"@base.email":{templateUrl:function(e,t){return"/messaging/email/forward/"+e.id+"/"},controller:a,controllerAs:"vm"}}})}function a(t,a,n,i,r,o,s,c){function l(){n.remove("/messaging/email/compose/"),"reply"==a.messageType?o.get({id:a.id}).$promise.then(function(e){u(e)}):u()}function u(n){var o,l=a.email,u=[],d=null;n?(o=r.query({filterquery:"email_addresses.email_address:"+n.sender.email_address}).$promise,u.push(o)):l&&(o=r.query({filterquery:"email_addresses.email_address:"+l}).$promise,u.push(o));var m=s.query().$promise;u.push(m),i.all(u).then(function(i){var r;if(o){var s=i[0][0];if(r=i[1],n&&(l=n.sender.email_address),s){var u='"'+s.name+'" <'+l+">",m=s.name+" <"+l+">";d={id:u,text:m,object_id:s.id}}else d={id:l,text:l,object_id:null}}else r=i[0];var f=a.template,p=void 0==f,g=a.messageType?a.messageType:"new";HLInbox.init(),HLInbox.initEmailCompose({templateList:r,defaultEmailTemplateUrl:"/messaging/email/templates/get-default/",getTemplateUrl:"/messaging/email/templates/detail/",messageType:g,loadDefaultTemplate:p,recipient:d,template:f}),HLInbox.setSuccesURL(t.previousState),c.currentAccountId&&e.element(HLInbox.config.emailAccountInput).select2("val",c.currentAccountId)})}t.conf.pageTitleBig="Send email",t.conf.pageTitleSmall="sending love through the world!",l()}e.module("app.email").config(t),t.$inject=["$stateProvider"],e.module("app.email").controller("EmailComposeController",a),a.$inject=["$scope","$stateParams","$templateCache","$q","ContactDetail","EmailMessage","EmailTemplate","SelectedEmailAccount"]}(angular),function(e){"use strict";function t(e){e.state("base.email.detail",{url:"/detail/{id:[0-9]{1,}}",views:{"@base.email":{templateUrl:"email/controllers/detail.html",controller:a,controllerAs:"vm"}}})}function a(e,t,a,n,i,r){function o(){s()}function s(){n.get({id:a.id},function(e){e.body_html&&(e.bodyHTMLUrl="/messaging/email/html/"+e.id+"/"),f.message=e,f.message.all_recipients=e.received_by.concat(e.received_by_cc),i.getInformation(f.message.all_recipients),e.read||n.markAsRead(a.id,!0),r.setCurrentAccountId(f.message.account)})}function c(){n.archive({id:f.message.id}).$promise.then(function(){t.go("base.email.list",{labelId:"INBOX"})})}function l(){n.trash({id:f.message.id}).$promise.then(function(){t.go("base.email.list",{labelId:"INBOX"})})}function u(){n["delete"]({id:f.message.id}).$promise.then(function(){t.go("base.email.list",{labelId:"INBOX"})})}function d(){f.displayAllRecipients=!f.displayAllRecipients;var e=$(".email-recipients");e.height(f.displayAllRecipients?e[0].scrollHeight:"1.30em")}function m(){n.markAsRead(f.message.id,!1).$promise.then(function(){t.go("base.email.list",{labelId:"INBOX"})})}var f=this;f.displayAllRecipients=!1,f.message=null,f.archiveMessage=c,f.trashMessage=l,f.deleteMessage=u,f.toggleOverlay=d,f.markAsUnread=m,e.conf.pageTitleBig="Email message",e.conf.pageTitleSmall="sending love through the world!",o()}e.module("app.email").config(t),t.$inject=["$stateProvider"],e.module("app.email").controller("EmailDetail",a),a.$inject=["$scope","$state","$stateParams","EmailMessage","RecipientInformation","SelectedEmailAccount"]}(angular),function(e){"use strict";function t(e){e.state("base.email.list",{url:"/all/{labelId}",views:{"@base.email":{templateUrl:"email/controllers/email_list.html",controller:a,controllerAs:"vm"}}}),e.state("base.email.accountAllList",{url:"/account/{accountId}/all",views:{"@base.email":{templateUrl:"email/controllers/email_list.html",controller:a,controllerAs:"vm"}}}),e.state("base.email.accountList",{url:"/account/{accountId}/{labelId}",views:{"@base.email":{templateUrl:"email/controllers/email_list.html",controller:a,controllerAs:"vm"}}})}function a(e,t,a,n,i,r,o,s,c){function l(){S.table.filter=e.search().search||"",u(),c.setCurrentAccountId(n.accountId)}function u(){t.$watchGroup(["vm.table.filter","vm.table.page"],function(e,t){""==t[0]&&""!=e[0]&&S.setPage(0),x()})}function d(e){e>=0&&e*S.table.pageSize<S.table.totalItems&&(S.table.page=e)}function m(){for(var e in S.emailMessages)S.emailMessages[e].checked=S.opts.checkboxesAll}function f(e){for(var t in S.emailMessages)S.emailMessages[t].checked&&(i.markAsRead(S.emailMessages[t].id,e),S.emailMessages[t].read=e)}function p(){var e=0;for(var t in S.emailMessages)if(S.emailMessages[t].checked&&(e++,e>1))return!1;return 1==e}function g(){for(var e in S.emailMessages)if(S.emailMessages[e].checked)return S.emailMessages[e]}function h(){var e=g();e&&a.go("base.email.reply",{id:e.id})}function v(){var e=g();e&&a.go("base.email.replyAll",{id:e.id})}function b(){var e=g();e&&a.go("base.email.forward",{id:e.id})}function y(){f(!0)}function $(){f(!1)}function w(){for(var e=S.emailMessages.length;e--;)S.emailMessages[e].checked&&S.emailMessages.splice(e,1)}function _(){for(var e in S.emailMessages)S.emailMessages[e].checked&&i.archive({id:S.emailMessages[e].id});w()}function C(){for(var e in S.emailMessages)S.emailMessages[e].checked&&i.trash({id:S.emailMessages[e].id});w()}function T(){for(var e in S.emailMessages)S.emailMessages[e].checked&&i["delete"]({id:S.emailMessages[e].id});w()}function A(e){var t=[];S.label.label_id&&(t=[S.label.label_id]);var a=[e],n={remove_labels:t,add_labels:a};for(var r in S.emailMessages)S.emailMessages[r].checked&&i.move({id:S.emailMessages[r].id,data:n});w()}function D(){S.emailMessages=[],x()}function k(e){window.open("/messaging/email/draft/"+e+"/","_self")}function x(){var e=[];e.push(n.labelId?"label_id:"+n.labelId:"NOT label_id:Sent"),n.accountId?(e.push("account:"+n.accountId),n.labelId&&r.query({label_id:n.labelId,account__id:n.accountId},function(e){e.length?(S.label=e[0],S.label.name=S.label.name.hlCapitalize()):S.label={id:n.labelId,name:n.labelId.hlCapitalize()}}),S.account=o.get({id:n.accountId})):S.label={id:n.labelId,name:n.labelId.hlCapitalize()},n.labelId&&"TRASH"!=n.labelId&&e.push("is_removed:false"),e&&(e=e.join(" AND ")),i.search({filterquery:e,q:S.table.filter,size:S.table.pageSize,page:S.table.page},function(e){S.emailMessages=e.hits,S.table.totalItems=e.total})}var S=this;S.emailMessages=[],S.table={page:0,pageSize:20,totalItems:0,filter:""},S.opts={checkboxesAll:!1},S.primaryEmailAccount=null,S.setPage=d,S.toggleCheckboxes=m,S.showReplyOrForwardButtons=p,S.replyOnMessage=h,S.replyAllOnMessage=v,S.forwardOnMessage=b,S.markAsRead=y,S.markAsUnread=$,S.archiveMessages=_,S.trashMessages=C,S.deleteMessages=T,S.moveMessages=A,S.reloadMessages=D,S.goToDraft=k,t.conf.pageTitleBig="Email",t.conf.pageTitleSmall="sending love through the world!",l()}e.module("app.email").config(t),t.$inject=["$stateProvider"],e.module("app.email").controller("EmailListController",a),a.$inject=["$location","$scope","$state","$stateParams","EmailMessage","EmailLabel","EmailAccount","HLText","SelectedEmailAccount"]}(angular),function(e){"use strict";function t(t,a,n,i,r){function o(){s()}function s(){c();var t=a(c,6e4);n.$on("$destroy",function(){e.isDefined(t)&&(a.cancel(t),t=void 0)})}function c(){i.mine(function(a){a=t("orderBy")(a,"id"),d.accountList=[],e.forEach(a,function(e){e.id!=d.primaryEmailAccountId?this.push(e):this.unshift(e)},d.accountList);var n={};for(var i in d.accountList)for(var r in d.accountList[i].labels){var o=d.accountList[i].labels[r];0==o.label_type&&(n.hasOwnProperty(o.label_id)?n[o.label_id]+=parseInt(o.unread):n[o.label_id]=parseInt(o.unread))}d.labelCount=n})}function l(t,a){var n=0;return e.forEach(t.labels,function(e){return e.label_id==a?(n=e.unread,!0):void 0}),n}function u(e,t){return l(e,t)>0}var d=this;d.accountList=[],d.primaryEmailAccountId=r,d.labelCount=0,d.hasUnreadLabel=u,d.unreadCountForLabel=l,o()}e.module("app.email").controller("LabelListController",t),t.$inject=["$filter","$interval","$scope","EmailAccount","primaryEmailAccountId"]}(angular),function(e){"use strict";function t(e){return{restrict:"A",scope:{message:"="},replace:!0,templateUrl:"email/directives/contact_icon.html",link:function(t,a,n){t.message.sender_email?e.get("/search/emailaddress/"+t.message.sender_email).success(function(e){t.emailAddressResults=e,t.status="contact"==e.type?e.data.accounts?"complete":"needsAccount":"account"==e.type?e.complete?"complete":"needsContact":"needsEverything"}):t.status="complete"}}}e.module("app.email.directives").directive("contactIcon",t),t.$inject=["$http"]}(angular),function(e){"use strict";function t(e){return e("/api/messaging/email/account/:id/",null,{update:{method:"PUT"},shareWith:{method:"POST",url:"/api/messaging/email/account/:id/shared/"},mine:{method:"GET",url:"/api/messaging/email/account/mine/",isArray:!0}})}e.module("app.email.services").factory("EmailAccount",t),t.$inject=["$resource"]}(angular),function(e){"use strict";function t(t){return t("",{size:100},{query:{url:"/search/search/?type=email_emailmessage&size=:size&sort=-sent_date&filterquery=:filterquery&account_related=:account_related",isArray:!0,transformResponse:function(t){t=e.fromJson(t);var a=[];return t&&t.hits&&t.hits.length>0&&t.hits.forEach(function(e){e=$.extend(e,{historyType:"email",color:"green",date:e.sent_date,right:!1}),a.push(e)}),a}}})}e.module("app.email.services").factory("EmailDetail",t),t.$inject=["$resource"]}(angular),function(e){"use strict";function t(e){return e("/api/messaging/email/label/:id/")}e.module("app.email.services").factory("EmailLabel",t),t.$inject=["$resource"]}(angular),function(e){"use strict";function t(e,t){function a(e,t){return this.update({id:e,read:t})}function n(e,a){var n=["read:false AND label_id:INBOX"],r="";r+=a?"-":"",r+=e;var o=t.defer();return i.search({filterquery:n,sort:r},function(e){o.resolve(e.hits)}),o.promise}var i=e("/api/messaging/email/email/:id/:actions",{},{update:{method:"PUT",params:{id:"@id",actions:""}},"delete":{method:"DELETE",params:{id:"@id",actions:""}},archive:{method:"PUT",params:{id:"@id",actions:"archive"}},trash:{method:"PUT",params:{id:"@id",actions:"trash"}},get:{method:"GET",params:{id:"@id",actions:""}},move:{method:"PUT",params:{id:"@id",actions:"move"}},search:{method:"GET",url:"/search/search/",params:{user_email_related:1,type:"email_emailmessage",sort:"-sent_date",size:20}}});return i.markAsRead=a,i.getDashboardMessages=n,i}e.module("app.email.services").factory("EmailMessage",t),t.$inject=["$resource","$q"]}(angular),function(e){"use strict";function t(e){return e("/api/messaging/email/emailtemplate/:id/")}e.module("app.email.services").factory("EmailTemplate",t),t.$inject=["$resource"]}(angular),function(e){"use strict";function t(e){function t(t){t.forEach(function(t){""!=t.name&&e.get("/search/emailaddress/"+t.email_address).success(function(e){"contact"==e.type&&e.data.id&&(t.contact_id=e.data.id)})})}var a={};return a.getInformation=t,a}e.module("app.email.services").factory("RecipientInformation",t),t.$inject=["$http"]}(angular),function(e){"use strict";function t(){function e(e){t.currentAccountId=e}var t={currentAccountId:null,setCurrentAccountId:e};return t}e.module("app.email.services").factory("SelectedEmailAccount",t)}(angular);
//# sourceMappingURL=app.min.js.map