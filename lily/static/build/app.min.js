!function(e){"use strict";e.module("app.accounts",["ngCookies","ui.bootstrap","ui.slimscroll","app.accounts.services","app.cases.services","app.email.services","contactServices","noteServices"])}(angular),function(e){"use strict";e.module("app.cases",["ngCookies","ui.bootstrap","app.accounts.services","app.cases.services","app.email.services","contactServices","noteServices"])}(angular),function(e){"use strict";e.module("app.accounts.directives",[])}(angular),function(e){"use strict";e.module("app.base",["ui.bootstrap"])}(angular),function(e){"use strict";e.module("app.directives",[])}(angular),function(e){"use strict";e.module("app.filters",[])}(angular),function(e){"use strict";e.module("app.services",[])}(angular),function(e){"use strict";e.module("app.cases.directives",[])}(angular),function(e){"use strict";e.module("app.cases.services",["ngResource"])}(angular),function(e){"use strict";!function(){function t(e,t,a){function n(e,a,n,r,i){var s="";return i&&(s+="-"),s+=r,t({url:"/search/search/",method:"GET",params:{type:"accounts_account",q:e,page:a-1,size:n,sort:s}}).then(function(e){return{accounts:e.data.hits,total:e.data.total}})}function r(){var t=this,a=e("filter")(t.email_addresses,{status:2});return a.length?a[0]:t.email_addresses.length?t.email_addresses[0]:void 0}var i=a("/api/accounts/account/:id",null,{update:{method:"PUT",params:{id:"@id"}},"delete":{method:"DELETE"}});return i.getAccounts=n,i.prototype.getEmailAddress=r,i}e.module("app.accounts.services",["ngResource"]),e.module("app.accounts.services").factory("AccountDetail",["$resource",function(t){function a(e){return e.phone_mobile?e.phone_mobile[0]:e.phone_work?e.phone_work[0]:e.phone_other?e.phone_other[0]:""}function n(e){var t=[];return e.phone_mobile&&(t=t.concat(e.phone_mobile)),e.phone_work&&(t=t.concat(e.phone_work)),e.phone_other&&(t=t.concat(e.phone_other)),t}return t("/search/search/?type=accounts_account&filterquery=id::id",{},{get:{transformResponse:function(t){if(t=e.fromJson(t),t&&t.hits&&t.hits.length>0){var r=t.hits[0];return r.phone=a(r),r.phones=n(r),r}return null}}})}]),e.module("app.accounts.services").factory("Account",t),t.$inject=["$filter","$http","$resource"]}()}(angular),function(e){"use strict";!function(e,t,a,n,r,i,s){e.GoogleAnalyticsObject=r,e[r]=e[r]||function(){(e[r].q=e[r].q||[]).push(arguments)},e[r].l=1*new Date,i=t.createElement(a),s=t.getElementsByTagName(a)[0],i.async=1,i.src=n,s.parentNode.insertBefore(i,s)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-60721851-1","auto")}(angular),function(e){"use strict";function t(e){var t={layout:{pageSidebarClosed:!1}};return e.settings=t,t}function a(e,t,a,n,r){e.setOptions({templateUrl:"breadcrumbs.html",includeAbstract:!0}),t.allowGlobals(),a.defaults.xsrfCookieName="csrftoken",a.defaults.xsrfHeaderName="X-CSRFToken",n.defaults.stripTrailingSlashes=!1,r.otherwise("/")}function n(e,t,a){e.$state=t,e.currentUser=currentUser,e.settings=a}e.module("app",["ui.router","ui.bootstrap","ngResource","ngSanitize","ncy-angular-breadcrumb","app.accounts","app.base","app.cases","app.dashboard","app.email","app.preferences","app.preferences.email","app.preferences.user","app.templates","ContactsControllers","DealControllers","UtilsControllers","app.directives","app.accounts.directives","app.cases.directives","app.contacts.directives","app.deals.directives","UtilsDirectives","angulartics","angulartics.google.analytics","app.services","app.filters"]),e.module("app").factory("settings",t),t.$inject=["$rootScope"],e.module("app").config(a),a.$inject=["$breadcrumbProvider","$controllerProvider","$httpProvider","$resourceProvider","$urlRouterProvider"],e.module("app").run(n),n.$inject=["$rootScope","$state","settings"]}(angular),function(e){"use strict";$("body").on("blur",'input[name^="phone"]',function(){var e=$(this),t=e.val();if(t.match(/[a-z]|[A-Z]/))return!1;if(t.match(/^\+316|^06/)){var a=e.attr("id").replace("raw_input","type");$("#"+a).select2("val","mobile")}return t=t.replace("(0)","").replace(/\s|\(|\-|\)|\.|x|:|\*/g,"").replace(/^00/,"+"),0==t.length?!1:(t.startsWith("+")||(t.startsWith("0")&&(t=t.substring(1)),t="+31"+t),t.startsWith("+310")&&(t="+31"+t.substring(4)),void e.val(t))}),$("body").on("change",'select[id*="is_primary"]',function(e){"True"==$(e.currentTarget).val()&&($('select[id*="is_primary"]').each(function(e){$(this).is("select")&&"True"==$(this).val()&&$(this).val("False")}),$(e.currentTarget).val("True"),HLSelect2.init())})}(angular),function(e){"use strict";!function(e,t,a,n){var r;t.HLCases={config:{caseUpdateUrl:"/cases/update/status/",caseUpdateAssignedToUrl:"/cases/update/assigned_to/",caseId:null,statusSpan:"#status",statusDiv:"#case-status",parcelProviderSelect:"#id_parcel_provider",parcelIdentifierInput:"#id_parcel_identifier",assignedToField:"#id_assigned_to",assignToMeButton:".assign-me-btn",currentAssignedTo:null},init:function(t){var a=this;e.isPlainObject(t)&&e.extend(a.config,t),a.initListeners(),a.setCurrentStatus()},initListeners:function(){var t=this,a=t.config;e(a.statusDiv).on("click",function(e){t.changeStatus.call(t,e)}),e(a.parcelProviderSelect).on("change",function(){t.changedParcelProviderSelect.call(t,this)}),e(a.assignToMeButton).on("click",function(){t.changeAssignedTo.call(t,this)})},setCurrentStatus:function(){r=e("input[name=radio]:checked",this.config.statusDiv).closest("label").attr("for")},changeStatus:function(t){var a=this,n=a.config,i=e("#"+e(t.target).closest("label").attr("for"));if(i.attr("id")!=r){var s=e(i);null!=n.caseId&&e.ajax({url:n.caseUpdateUrl+n.caseId+"/",type:"POST",data:{status:s.val()},beforeSend:HLApp.addCSRFHeader,dataType:"json"}).done(function(t){r=s.attr("id"),e(n.statusSpan).text(t.status),load_notifications()}).fail(function(){e(i).attr("checked",!1).closest("label").removeClass("active"),e("#"+r).attr("checked",!0).closest("label").addClass("active"),load_notifications()})}},changedParcelProviderSelect:function(t){var a=e(t);a.val()||e(this.config.parcelIdentifierInput).val("")},changeAssignedTo:function(){var t=this,a=t.config,n=null;a.currentAssignedTo!=currentUser.id&&(n=currentUser.id),null!=a.caseId&&e.ajax({url:a.caseUpdateAssignedToUrl+a.caseId+"/",type:"POST",data:{assignee:n},beforeSend:HLApp.addCSRFHeader,dataType:"json"}).done(function(t){var n=t.assignee;n?(e(".summary-data.assigned-to").html(t.assignee.name),e(".assign-me-btn").html("Unassign"),a.currentAssignedTo=t.assignee.id):(e(".summary-data.assigned-to").html("Unassigned"),e(".assign-me-btn").html("Assign to me"),a.currentAssignedTo=null)}).always(function(){load_notifications()})},addAssignToMeButton:function(){var t=this,a=e('<button class="btn btn-link assign-me-btn">Assign to me</button>');e(t.config.assignedToField).after(a),a.click(function(a){a.preventDefault(),e(t.config.assignedToField).val(currentUser.id).change()})}}}(jQuery,window,document)}(angular),function(e){"use strict";!function(e,t,a,n){t.HLFormsets={config:{formsetClass:".formset"},init:function(t){var a=this;e.isPlainObject(t)&&e.extend(a.config,t),e(a.config.formsetClass).formset(),a.initListeners()},initListeners:function(){var t=e("body");t.on("formAdded","[data-formset-form]",function(){var t=e(this).parents(".formset"),a=e(t).find(".add-link"),n="true"==(e(t).attr("data-formset-indent")||"true");n&&e(a).find(".form-control-static").addClass("col-md-offset-2").removeClass("form-control-static"),e(a).find("label").addClass("hide"),1===e(t).find("[data-formset-form]").length&&(e(this).find("label.hide").removeClass("hide"),n&&e(this).find(".field_wrapper").removeClass("col-md-offset-2")),HLSelect2.init()}),t.on("formDeleted","[data-formset-form]",function(){e(this).stop().slideDown(),e(this).find(":input:enabled:visible").attr("data-formset-disabled",!0).attr("readonly","readonly"),e(this).find("[data-formset-delete-button]").toggleClass("hidden"),e(this).find("[data-formset-undo-delete]").toggleClass("hidden")}),t.on("click","[data-formset-form] [data-formset-undo-delete]",function(){var t=e(this).closest("[data-formset-form]");t.find("[data-formset-disabled=true]").removeAttr("data-formset-disabled").removeAttr("readonly"),t.find('input[name$="DELETE"]').attr("checked",!1).change(),t.find("[data-formset-delete-button]").toggleClass("hidden"),e(this).toggleClass("hidden")})}}}(jQuery,window,document)}(angular),function(e){"use strict";!function(e,t,a,n){t.HLSelect2={config:{tagInputs:"input.tags",ajaxInputs:"input.select2ajax",tagsAjaxClass:"tags-ajax",ajaxPageLimit:30,clearText:"-- Clear --"},init:function(t){var a=this;e.isPlainObject(t)&&e.extend(a.config,t),a.setupSelect2(),a.initListeners()},initListeners:function(){var t=this;e(a).on("shown.bs.modal",".modal",function(){t.setupSelect2()})},setupSelect2:function(){e("select").select2({minimumResultsForSearch:9}),this.createTagInputs(),this.createAjaxInputs()},createTagInputs:function(){e(this.config.tagInputs).each(function(){if(!e(this).data().hasOwnProperty("select2")){var t=[],a=e(this);a.data("choices")&&(t=a.data("choices").split(",")),a.select2({tags:t,tokenSeparators:[","," "],width:"100%"})}})},createAjaxInputs:function(){var t=this,a=t.config;e(a.ajaxInputs).each(function(){var t=e(this),n=t.data();if(!n.hasOwnProperty("select2")){var r={ajax:{cache:!0,data:function(r,i){var s=null;if(t.hasClass(a.tagsAjaxClass)&&!n.tags){""===r&&(r="*");var o="((_type:contacts_contact AND (name:"+r+" OR email_addresses.email_address:"+r+")) OR (_type:accounts_account AND (name:"+r+" OR email_addresses.email_address:"+r+"))) AND email_addresses.email_address:*";s={filterquery:o,size:a.ajaxPageLimit,page:i-1,sort:"-modified"}}else{var c=r.trim();s={filterquery:c?"name:("+c+")":"",size:a.ajaxPageLimit,page:i-1,sort:"-modified"}}var l=t.data("filter-on");return"undefined"!=typeof l&&""!==l&&l.split(",").forEach(function(t){if(0===t.indexOf("id_")){var a=e("#"+t).val(),n=t.substring(3);0===n.indexOf("case_quickbutton_")?n=t.substring(20):"account"==n&&(n="accounts.id"),a&&a>0&&(s.filterquery+=" "+n+":"+a)}else s.type=t}),s},results:function(e,r){var i=r*a.ajaxPageLimit<e.total;if(t.hasClass(a.tagsAjaxClass)&&!n.tags){var s=[];e.hits.forEach(function(e){for(var t=0;t<e.email_addresses.length;t++){var a='"'+e.name+'" <'+e.email_addresses[t].email_address+">",n=e.name+" <"+e.email_addresses[t].email_address+">";s.push({id:a,text:n,object_id:e.id})}}),e.hits=s}else e.hits.forEach(function(e){e.text=e.name});return 1!=r||t.hasClass(a.tagsAjaxClass)||n.tags||e.hits.unshift({id:-1,text:a.clearText}),{results:e.hits,more:i}}},initSelection:function(e,t){var a=e.val(),n=e.data("selected-text"),r={id:a,text:n};t(r)}};t.hasClass(a.tagsAjaxClass)&&(r.tags=!0,r.tokenSeparators=[","," "],r.createSearchChoice=function(t,a){return 0===e(a).filter(function(){return 0===this.text.localeCompare(t)}).length?{id:t,text:t}:void 0},r.openOnEnter=!1),n.tags&&(r.tags=!0,r.multiple=!0),t.select2(r),n.tags&&t.select2("data",n.initial)}})}}}(jQuery,window,document)}(angular),function(e){"use strict";!function(e,t,a,n){t.HLShowAndHide={config:{selector:".show-and-hide-input"},init:function(t){var a=this;e.isPlainObject(t)&&e.extend(a.config,t),a.initListeners()},initListeners:function(){e("body").on("click",".form .toggle-original-form-input",function(){var t=e(this).closest(".show-and-hide-input");if(e(this).parent().addClass("hide"),"show"==e(this).data("action")){e(t).find('[data-action="hide"]').parent().removeClass("hide"),e(t).find(".original-form-widget").removeClass("hide"),e(t).find(":input").removeAttr("disabled");var a=e(t).find(':input:visible:not([type="file"]):first');a&&setTimeout(function(){},0)}else"hide"==e(this).data("action")&&(e(t).find('[data-action="show"]').parent().removeClass("hide"),e(t).find(".original-form-widget").addClass("hide"),e(t).find(":input").attr("disabled","disabled"))})}}}(jQuery,window,document)}(angular),function(e){"use strict";!function(e,t,a,n){t.HLDataProvider={config:{buttonDataProvider:":button.dataprovider",loadingText:"Beaming up the information now, almost within range!",loadingHeader:"I'm on my way!",provideUrl:"/provide/account/",dataProviderClass:".dataprovider",errorHeader:"Oops!",errorText:"There was an error trying to fetch your data, please don't be mad.",successHeader:"Yeah!",successText:"We did it! Your new data should be right there waiting for you.",hiddenSuccessHeader:"Psst!",hiddenSuccessText:"Did you know I did more work in the background? ;)",overwriteConfirmHeader:"Do you wish to overwrite the following fields?\n",fields:["name","description","legalentity","taxnumber","bankaccountnumber","cocnumber","iban","bic"],formsets:["email_addresses","phone_numbers","addresses"]},init:function(t){var a=this;e.isPlainObject(t)&&e.extend(a.config,t),a.initListeners()},initListeners:function(){var t=this,a=t.config;e("body").on("click",a.buttonDataProvider,function(e){t.findDataProviderInfo.call(t,this,e)}).on("keydown","div"+a.dataProviderClass+" > input",function(e){13===e.which&&(t.findDataProviderInfo.call(t,a.buttonDataProvider,e),e.preventDefault())})},findDataProviderInfo:function(t,a){var n=this,r=n.config,i=e(t),s=i.closest("form"),o=e("div"+r.dataProviderClass+" > input"),c=n.sanitizeDomain(o.val());i.button("loading"),toastr.info(r.loadingText,r.loadingHeader);var l=r.provideUrl+c;e.getJSON(l).done(function(e){e.error?toastr.error(e.error.message,r.errorHeader):(n.fillForm(s,e,r.fields,r.formsets),toastr.success(r.successText,r.successHeader))}).fail(function(){toastr.error(r.errorText,r.errorHeader)}).always(function(){i.button("reset")}),a.preventDefault()},sanitizeDomain:function(t){var a=e.trim(t.replace("http://",""));return a=e.trim(a.replace("https://","")),"/"!==a.slice(-1)&&(a+="/"),a},fillForm:function(e,t,a,n){var r=this,i=r.config,s=r.loopTroughFields(a,e,t),o=s[0],c=s[1];o.length&&confirm(i.overwriteConfirmHeader+c.join("\n"))&&o.forEach(function(a){var n=e.find('[name="'+a+'"]');r.fillField(n,t[a])}),r.loopTroughFormSets(n,e,t)},loopTroughFields:function(e,t,a){var r=this,i=r.config,s=[],o=[],c=!1;return e.forEach(function(e){var i=t.find('[name="'+e+'"]');if(("hidden"==i.attr("type")||i.parent().hasClass("hide"))&&(i.val(""),a[e]&&(c=!0)),a[e]&&i.val()!==n)if(i.val().length&&i.val()!==i.attr("placeholder")){var l=i.parents(".form-group").find("label").text();s.push(e),o.push("- "+l)}else r.fillField(i,a[e])}),c&&toastr.success(i.hiddenSuccessText,i.hiddenSuccessHeader),[s,o]},loopTroughFormSets:function(t,a,n){for(var r=0;r<t.length;r++){var i=t[r];if(n[i]&&n[i].length)for(var s,o=a.find("#"+i),c=o.find("[data-formset-add]"),l=n[i],u=0;u<l.length;u++){var d,f=l[u],p=!1;if("object"==typeof f){var m,g=!1;for(m in f)s=o.find(':input[name$="'+m+'"]'),s.length&&(g=!0,s=s.filter(function(){var t=e(this).val(),a=f[m];return""===t&&null===a||t==a}),s.length||(p=!0));if(p||!g){c.click(),d=o.find("[data-formset-body] [data-formset-form]:last");for(m in f)d.find(':input[name$="'+m+'"]').val(f[m])}}else"string"==typeof f&&(s=o.find(":input").filter(function(){return e(this).val()==f}),s.length||(c.click(),d=o.find("[data-formset-body] [data-formset-form]:last"),d.find(":input:first").val(f)))}}},fillField:function(e,t){if("string"==typeof t)e.val(t);else if("string"==typeof t[0]){var a=t.concat(e.val().split(",")).filter(function(e,t,a){return a.indexOf(e)===t&&""!==e});e.val(a.join())}else e.val(JSON.stringify(t));e.change(),e.parent().hasClass("original-form-widget")&&e.parent().hasClass("hide")&&e.parents(".show-and-hide-input").find('a[data-action="show"]').trigger("click")}}}(jQuery,window,document)}(angular),function(e){"use strict";function t(e){e.state("base.accounts.detail.delete",{url:"/delete",views:{"@":{controller:"AccountDeleteController"}}})}function a(e,t,a){var n=t.id;a["delete"]({id:n},function(){e.go("base.accounts")},function(t){e.go("base.accounts")})}e.module("app.accounts").config(t),t.$inject=["$stateProvider"],e.module("app.accounts").controller("AccountDeleteController",a),a.$inject=["$state","$stateParams","Account"]}(angular),function(e){"use strict";function t(e){e.state("base.accounts.detail",{url:"/{id:[0-9]{1,}}",views:{"@":{templateUrl:"accounts/controllers/detail.html",controller:a}},ncyBreadcrumb:{label:"{{ account.name }}"},resolve:{account:["AccountDetail","$stateParams",function(e,t){var a=t.id;return e.get({id:a}).$promise}]}})}function a(e,t,a,n,r,i){var s=t.id;e.account=i,e.conf.pageTitleBig=i.name,e.conf.pageTitleSmall="change is natural",e.caseList=a.query({filterquery:"account:"+s}),e.caseList.$promise.then(function(t){e.caseList=t}),e.dealList=r.query({filterquery:"account:"+s}),e.dealList.$promise.then(function(t){e.dealList=t}),e.contactList=n.query({filterquery:"accounts.id:"+s}),e.contactList.$promise.then(function(t){e.contactList=t})}e.module("app.accounts").config(t),t.$inject=["$stateProvider"],e.module("app.accounts").controller("AccountDetailController",a),a.$inject=["$scope","$stateParams","CaseDetail","ContactDetail","DealDetail","account"]}(angular),function(e){"use strict";function t(e){e.state("base.accounts",{url:"/accounts",views:{"@":{templateUrl:"accounts/controllers/list.html",controller:a,controllerAs:"vm"}},ncyBreadcrumb:{label:"Accounts"}})}function a(t,a,n,r){function i(){l()}function s(e){confirm("Are you sure?")&&n["delete"]({id:e.id},function(){var t=f.table.items.indexOf(e);f.table.items.splice(t,1)},function(e){alert("something went wrong.")})}function o(){p.put("filter",f.table.filter),p.put("order",f.table.order),p.put("visibility",f.table.visibility)}function c(){n.getAccounts(f.table.filter,f.table.page,f.table.pageSize,f.table.order.column,f.table.order.ascending).then(function(e){f.table.items=e.accounts,f.table.totalItems=e.total})}function l(){t.$watchGroup(["vm.table.page","vm.table.order.column","vm.table.order.ascending","vm.table.filter"],function(){o(),c()}),t.$watchCollection("vm.table.visibility",function(){o()})}function u(e){f.table.filter=e}function d(){var t="";f.table.filter&&(t+="&export_filter="+f.table.filter),e.forEach(f.table.visibility,function(e,a){e&&(t+="&export_columns="+a)});var n="/accounts/export/";t&&(n+="?"+t.substr(1)),a.open(n)}var f=this,p=r("accountList");f.table={page:1,pageSize:20,totalItems:0,filter:p.get("filter",""),order:p.get("order",{ascending:!0,column:"modified"}),visibility:p.get("visibility",{name:!0,contactInformation:!0,assignedTo:!0,created:!0,modified:!0,tags:!0,customerId:!0})},f.deleteAccount=s,f.setFilter=u,f.exportToCsv=d,i(),t.conf.pageTitleBig="Accounts",t.conf.pageTitleSmall="An overview of accounts"}e.module("app.accounts").config(t),t.$inject=["$stateProvider"],e.module("app.accounts").controller("AccountList",a),a.$inject=["$scope","$window","Account","Cookie"]}(angular),function(e){"use strict";function t(e){e.state("base.accounts.create",{url:"/create",views:{"@":{templateUrl:"/accounts/create/",controller:"AccountUpsertController"}},ncyBreadcrumb:{label:"Create"}}),e.state("base.accounts.detail.edit",{url:"/edit",views:{"@":{templateUrl:function(e){return"/accounts/"+e.id+"/edit/"},controller:"AccountUpsertController"}},ncyBreadcrumb:{label:"Edit"}})}function a(e,t,a){var n=t.id;if(n){var r=a.get({id:n}).$promise;r.then(function(t){e.account=t,e.conf.pageTitleBig=t.name,e.conf.pageTitleSmall="change is natural",HLSelect2.init()})}else e.conf.pageTitleBig="New Account",e.conf.pageTitleSmall="change is natural";HLDataProvider.init(),HLFormsets.init()}e.module("app.accounts").config(t),t.$inject=["$stateProvider"],e.module("app.accounts").controller("AccountUpsertController",a),a.$inject=["$scope","$stateParams","AccountDetail"]}(angular),function(e){"use strict";function t(){return{restrict:"E",replace:!0,scope:{account:"=",height:"="},templateUrl:"accounts/directives/detail_widget.html"}}e.module("app.accounts.directives").directive("accountDetailWidget",t)}(angular),function(e){"use strict";function t(e){e.state("base",{"abstract":!0,controller:"baseController",ncyBreadcrumb:{label:"Lily"}})}function a(t,a,n){function r(){t.$on("$stateChangeSuccess",o),t.$on("$viewContentLoaded",s)}function i(){n.query(function(t){e.forEach(t,function(e){toastr[e.level](e.message)})},function(e){console.log("error!"),console.log(e)})}function s(){Metronic.initComponents(),HLSelect2.init(),HLFormsets.init(),HLShowAndHide.init(),autosize($("textarea")),t.loadNotifications()}function o(e,n,r,i,s){t.previousState=a.href(i,s)}t.conf={headTitle:"Welcome!",pageTitleBig:"HelloLily",pageTitleSmall:"welcome to my humble abode!"},t.loadNotifications=i,r()}e.module("app.base").config(t),t.$inject=["$stateProvider"],e.module("app.base").controller("baseController",a),a.$inject=["$scope","$state","Notifications"]}(angular),function(e){"use strict";function t(e){e.$on("$includeContentLoaded",function(){Layout.initHeader()})}e.module("app.base").controller("headerController",t),t.$inject=["$scope"]}(angular),function(e){"use strict";function t(e){e.$on("$includeContentLoaded",function(){Layout.initSidebar()})}e.module("app.base").controller("sidebarController",t),t.$inject=["$scope"]}(angular),function(e){"use strict";function t(){return{restrict:"E",replace:!0,transclude:!0,scope:{model:"="},templateUrl:"base/directives/checkbox.html"}}e.module("app.directives").directive("checkbox",t)}(angular),function(e){"use strict";function t(e){return{restrict:"A",require:"ngModel",link:function(t,a,n,r){r.$formatters.push(function(t){return t?e(t,n.dateFormatter):void 0})}}}e.module("app.directives").directive("dateFormatter",t),t.$inject=["dateFilter"]}(angular),function(e){"use strict";function t(e){return{restrict:"A",link:function(t,a,n){$(a).click(function(){confirm("You are deleting! Are you sure ?")&&e.go(".delete")})}}}e.module("app.directives").directive("detailDelete",t),t.$inject=["$state"]}(angular),function(e){"use strict";function t(){return{restrict:"A",link:function(e,t,a){var n=$("body").outerHeight();t.on("load",function(){t.removeClass("hidden");var e,a=this;try{e=a.contentWindow.document.documentElement}catch(r){try{e=a.contentDocument.documentElement}catch(i){}}if(e){var s=[t.offset().top,$(".footer").outerHeight(),$(".inbox-attached").outerHeight()];for(var o in s)n-=o;a.height=e.scrollHeight>n?n:e.scrollHeight}})}}}e.module("app.directives").directive("resizeIframe",t)}(angular),function(e){"use strict";function t(){var e=function(e,t,a){e.sorted=e.table.order.column===a?e.table.order.ascending?1:-1:0};return{restrict:"A",scope:{table:"="},transclude:!0,templateUrl:"base/directives/sort_column.html",link:function(t,a,n){t.$watchCollection("table.order",function(){e(t,a,n.sortColumn)}),a.on("click",function(){t.table.order.column===n.sortColumn?(t.table.order.ascending=!t.table.order.ascending,t.$apply()):(t.table.order.column=n.sortColumn,t.$apply())})}}}e.module("app.directives").directive("sortColumn",t)}(angular),function(e){"use strict";function t(e){return{link:function(t,a,n){a.addClass("hide"),e.$on("$stateChangeStart",function(){a.removeClass("hide")}),e.$on("$stateChangeSuccess",function(){a.addClass("hide"),$("body").removeClass("page-on-load"),setTimeout(function(){Metronic.scrollTop()},e.settings.layout.pageAutoScrollOnLoad)}),e.$on("$stateNotFound",function(){a.addClass("hide")}),e.$on("$stateChangeError",function(){a.addClass("hide")})}}}e.module("app.directives").directive("ngSpinnerBar",t),t.$inject=["$rootScope"]}(angular),function(e){"use strict";function t(){return function(e){return e.sort(function(e,t){return e-t}),e[0]}}e.module("app.filters").filter("minValue",t)}(angular),function(e){"use strict";function t(e){return function(t,a){var a=a||!0,n=a?"<br />":"<br>",t=(t+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1"+n+"$2");return e.trustAsHtml(t)}}e.module("app.filters").filter("nl2br",t),t.$inject=["$sce"]}(angular),function(e){"use strict";function t(e){return function(t,a,n){var r,i,s,o,c,l,u,d,f=new Date;if(t instanceof Date||(t=new Date(t),n&&(t.setHours(23),t.setMinutes(59),t.setSeconds(59))),s=null,c=60,o=60*c,i=24*o,l=7*i,u=30*i,d=365*i,r=function(){return s=Math.round((t-f)/1e3)},r(),s>i&&l>s&&(t=new Date(t.getFullYear(),t.getMonth(),t.getDate()),n&&(t.setHours(23),t.setMinutes(59),t.setSeconds(59)),r()),a||(a=window.innerWidth<992?"dd MMM. yyyy":"dd MMMM yyyy"),0>s)switch(!1){case!(-s>l):return e("date")(t,a);case!(-s>2*i):return""+-Math.ceil(s/i)+" days ago";case!(-s>i):return"yesterday";case!(-s>o):return""+-Math.ceil(s/o)+" hours ago";case!(-s>2*c):return""+-Math.ceil(s/c)+" minutes ago";case!(-s>c):return"a minutes ago";case!(-s>30):return""+-s+" seconds ago";default:return"just now"}else switch(!1){case!(30>s):return"just now";case!(c>s):return""+s+" seconds";case!(2*c>s):return"a minute";case!(o>s):return""+Math.floor(s/c)+" minutes";case 1!==Math.floor(s/o):return"an hour";case!(i>s):return""+Math.floor(s/o)+" hours";case!(2*i>s):return"tomorrow";case!(l>s):return""+Math.floor(s/i)+" days";case 1!==Math.floor(s/l):return"a week";default:return e("date")(t,a)}}}e.module("app.filters").filter("relativeDate",t),t.$inject=["$filter"]}(angular),function(e){"use strict";function t(e){return function(t){return e.trustAsResourceUrl(t)}}e.module("app.filters").filter("trustAsResourceUrl",t),t.$inject=["$sce"]}(angular),function(e){"use strict";function t(e){function t(e){return new a(e)}function a(e){this.prefix=e}return a.prototype.get=function(t,a){try{var n=e.get(this.prefix+t);return void 0!==n?n:a}catch(r){return e.remove(this.prefix+t),a}},a.prototype.put=function(t,a){e.put(this.prefix+t,a)},t}e.module("app.services").service("Cookie",t),t.$inject=["$cookieStore"]}(angular),function(e){"use strict";function t(){this.getSubtractedDate=function(e){var t=new Date;return t.setDate(t.getDate()-e),t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()}}e.module("app.services").service("HLDate",t)}(angular),function(e){"use strict";function t(){this.updateFilterQuery=function(e){e.table.filterQuery="",e.displayFilterClear=!1;for(var t=[],a=0;a<e.filterList.length;a++){var n=e.filterList[a];n.id&&"archived"==n.id?n.selected?e.displayFilterClear=!0:t.push("archived:false"):n.selected&&(t.push(n.value),e.displayFilterClear=!0)}e.table.filterQuery=t.join(" AND ")},this.clearFilters=function(e){for(var t=0;t<e.filterList.length;t++)e.filterList[t].selected=!1;e.updateFilterQuery()}}e.module("app.services").service("HLFilters",t)}(angular),function(e){"use strict";function t(){String.prototype.hlCapitalize=function(){var e=this.toLowerCase();return e.charAt(0).toUpperCase()+e.substring(1)}}e.module("app.services").service("HLText",t)}(angular),function(e){"use strict";function t(e){return e("/api/utils/notifications/")}e.module("app.services").factory("Notifications",t),t.$inject=["$resource"]}(angular),function(e){"use strict";function t(e,t,a,n){function r(){i()}function i(){n.query({},function(e){c.users=e})}function s(){a.update({id:c.myCase.id,assigned_to:c.currentAssigneeId}).$promise.then(function(){e.close()})}function o(){e.dismiss("cancel")}var c=this;c.myCase=t,c.currentAssigneeId=t.assigned_to_id,c.users=[],c.ok=s,c.cancel=o,r()}e.module("app.cases").controller("CaseAssignModal",t),t.$inject=["$modalInstance","myCase","Case","User"]}(angular),function(e){"use strict";function t(e){e.state("base.cases.create",{url:"/create",views:{"@":{templateUrl:"/cases/create",controller:a}},ncyBreadcrumb:{label:"Create"}}),e.state("base.cases.create.fromContact",{url:"/contact/{id:[0-9]{1,}}",views:{"@":{templateUrl:function(e,t){return"/cases/create/from_contact/"+e.id+"/"},controller:a}},ncyBreadcrumb:{skip:!0}}),e.state("base.cases.create.fromAccount",{url:"/account/{id:[0-9]{1,}}",views:{"@":{templateUrl:function(e,t){return"/cases/create/from_account/"+e.id+"/"},controller:a}},ncyBreadcrumb:{skip:!0}})}function a(e){e.conf.pageTitleBig="New case",e.conf.pageTitleSmall="making cases",HLCases.addAssignToMeButton(),HLSelect2.init()}e.module("app.cases").config(t),t.$inject=["$stateProvider"],e.module("app.cases").controller("CaseCreateController",a),a.$inject=["$scope"]}(angular),function(e){"use strict";function t(e){e.state("base.cases.detail.delete",{url:"/delete",views:{"@":{controller:a}}})}function a(e,t,a){var n=a.id,r={method:"POST",url:"/cases/delete/"+n+"/",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}};e(r).success(function(e,a,n,r){t.go("base.cases")}).error(function(e,a,n,r){t.go("base.cases")})}e.module("app.cases").config(t),t.$inject=["$stateProvider"],e.module("app.cases").controller("CaseDeleteController",a),a.$inject=["$http","$state","$stateParams"]}(angular),function(e){"use strict";function t(e){e.state("base.cases.detail",{url:"/{id:[0-9]{1,}}",views:{"@":{templateUrl:"cases/controllers/detail.html",controller:a,controllerAs:"vm"}},ncyBreadcrumb:{label:"{{ case.subject }}"}})}function a(e,t,a,n,r,i,s){function o(){if(p["case"].is_archived)return"label-default";switch(p["case"].priority){case 0:return"label-success";case 1:return"label-info";case 2:return"label-warning";case 3:return"label-danger";default:return"label-info"}}function c(t){var a={method:"POST",url:"/cases/update/status/"+p["case"].id+"/",data:"status="+t,headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}};e(a).success(function(e,t,a,n){p["case"].status=e.status}).error(function(e,t,a,n){})}function l(){var t="";p["case"].assigned_to_id!=currentUser.id&&(t=currentUser.id);var a={method:"POST",url:"/cases/update/assigned_to/"+p["case"].id+"/",data:"assignee="+t,headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}};e(a).success(function(e,t,a,n){e.assignee?(p["case"].assigned_to_id=e.assignee.id,p["case"].assigned_to_name=e.assignee.name):(p["case"].assigned_to_id=null,p["case"].assigned_to_name=null)}).error(function(e,t,a,n){})}function u(t){var a={method:"POST",url:"/cases/archive/",data:"id="+t,headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}};e(a).success(function(e,t,a,n){p["case"].archived=!0}).error(function(e,t,a,n){})}function d(t){var a={method:"POST",url:"/cases/unarchive/",data:"id="+t,headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}};e(a).success(function(e,t,a,n){p["case"].archived=!1}).error(function(e,t,a,n){})}function f(e){var a=t.open({templateUrl:"cases/controllers/postpone.html",controller:"CasePostponeModal",controllerAs:"vm",size:"sm",resolve:{myCase:function(){return e}}});a.result.then(function(){n.go(n.current,{},{reload:!0})})}var p=this;a.conf.pageTitleBig="Case",a.conf.pageTitleSmall="the devil is in the details";var m=r.id;p["case"]=i.get({id:m}),p.caseStatuses=s.query(),p.getPriorityDisplay=o,p.changeCaseStatus=c,p.assignCase=l,p.archive=u,p.unarchive=d,p.openPostponeWidget=f}e.module("app.cases").config(t),t.$inject=["$stateProvider"],e.module("app.cases").controller("CaseDetailController",a),a.$inject=["$http","$modal","$scope","$state","$stateParams","CaseDetail","CaseStatuses"]}(angular),function(e){"use strict";function t(e){e.state("base.cases.detail.edit",{url:"/edit",views:{"@":{templateUrl:function(e,t){return"/cases/update/"+e.id+"/"},controller:a}},ncyBreadcrumb:{label:"Edit"}})}function a(e,t,a){var n=t.id,r=a.get({id:n}).$promise;r.then(function(t){e["case"]=t,e.conf.pageTitleBig=t.subject,e.conf.pageTitleSmall="change is natural",HLSelect2.init()})}e.module("app.cases").config(t),t.$inject=["$stateProvider"],e.module("app.cases").controller("CaseEditController",a),a.$inject=["$scope","$stateParams","CaseDetail"]}(angular),function(e){"use strict";function t(e){e.state("base.cases",{url:"/cases",views:{"@":{templateUrl:"cases/controllers/list.html",controller:a}},ncyBreadcrumb:{label:"Cases"}})}function a(e,t,a,n,r,i,s,o,c){function l(){var e=f.get("filterList",null);if(e)n.filterList=e;else{var t=[{name:"Assigned to me",value:"assigned_to_id:"+n.currentUser.id,selected:!1},{name:"Assigned to nobody",value:"NOT(assigned_to_id:*)",selected:!1},{name:"Expired 7 days or more ago",value:"expires:[* TO "+o.getSubtractedDate(7)+"]",
selected:!1},{name:"Expired 30 days or more ago",value:"expires:[* TO "+o.getSubtractedDate(30)+"]",selected:!1},{name:"Archived",value:"",selected:!1,id:"archived"}];n.filterList=t,i.getCaseTypes().then(function(e){for(var a in e)e.hasOwnProperty(a)&&t.push({name:"Case type "+e[a],value:"casetype_id:"+a,selected:!1});n.filterList=t,u()})}}function u(){f.put("searchQuery",n.table.searchQuery),f.put("archived",n.table.archived),f.put("order",n.table.order),f.put("visibility",n.table.visibility),f.put("filterList",n.filterList)}function d(){i.getCases(n.table.searchQuery,n.table.page,n.table.pageSize,n.table.order.column,n.table.order.ascending,n.table.archived,n.table.filterQuery).then(function(e){n.table.items=e.cases,n.table.totalItems=e.total})}var f=s("caseList");n.conf.pageTitleBig="Cases",n.conf.pageTitleSmall="do all your lookin' here";var p="",m=t.search().search;p=void 0!=m?m:f.get("searchQuery",""),n.table={page:1,pageSize:60,totalItems:0,searchQuery:p,archived:f.get("archived",!1),order:f.get("order",{ascending:!0,column:"expires"}),visibility:f.get("visibility",{caseId:!0,client:!0,subject:!0,priority:!0,type:!0,status:!0,expires:!0,assignedTo:!0,createdBy:!0,tags:!0})},n.displayFilterClear=!1,l(),n.$watchGroup(["table.page","table.order.column","table.order.ascending","table.searchQuery","table.archived","table.filterQuery"],function(){u(),d()}),n.$watchCollection("table.visibility",function(){u()}),n.$watchCollection("filterList",function(){n.updateFilterQuery()}),n.setSearchQuery=function(e){n.table.searchQuery=e},n.toggleArchived=function(){n.table.archived=!n.table.archived},n.updateFilterQuery=function(){c.updateFilterQuery(n)},n.clearFilters=function(){c.clearFilters(n)},n["delete"]=function(t,a,r){var i={method:"POST",url:"/cases/delete/"+t+"/",headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"}};confirm("Are you sure you want to delete case "+a+"?")&&e(i).success(function(e,t,a,i){var s=n.table.items.indexOf(r);n.table.items.splice(s,1)}).error(function(e,t,a,n){})},n.assignTo=function(e){var t=a.open({templateUrl:"cases/controllers/assignto.html",controller:"CaseAssignModal",controllerAs:"vm",size:"sm",resolve:{myCase:function(){return e}}});t.result.then(function(){r.go(r.current,{},{reload:!0})})}}e.module("app.cases").config(t),t.$inject=["$stateProvider"],e.module("app.cases").controller("CaseListController",a),a.$inject=["$http","$location","$modal","$scope","$state","Case","Cookie","HLDate","HLFilters"]}(angular),function(e){"use strict";function t(e,t,a,n,r){function i(){s()}function s(){a.$watch("vm.pickerIsOpen",function(e,t){!e&&t&&o()})}function o(){if(f.expireDate!=new Date(r.expires)){var a=e("date")(f.expireDate,"yyyy-MM-dd");n.update({id:r.id},{expires:a},function(){t.close()})}else t.close()}function c(e,t){return"day"===t&&(0===e.getDay()||6===e.getDay())}function l(e){e.preventDefault(),e.stopPropagation(),f.pickerIsOpen=!0}function u(e){f.expireDate.setDate(f.expireDate.getDate()+e),o()}function d(e){var t=new Date(f.expireDate);return t.setDate(t.getDate()+e)}var f=this;f.myCase=r,f.pickerIsOpen=!1,f.expireDate=new Date(r.expires),f.dateFormat="dd MMMM yyyy",f.datepickerOptions={startingDay:1},f.disabledDates=c,f.openDatePicker=l,f.postponeWithDays=u,f.getFutureDate=d,i()}e.module("app.cases").controller("CasePostponeModal",t),t.$inject=["$filter","$modalInstance","$scope","Case","myCase"]}(angular),function(e){"use strict";function t(){return{restrict:"E",replace:!0,scope:{title:"@",list:"=",height:"=",addLink:"@"},templateUrl:"cases/directives/list_widget.html"}}e.module("app.cases.directives").directive("caseListWidget",t)}(angular),function(e){"use strict";function t(){return{restrict:"A",link:function(e,t,a){var n=$("#id_priority"),r=[5,3,1,0];n.on("change",function(e){var t=parseInt(n.val());isNaN(n.val())&&(t=3);var a=addBusinessDays(new Date,r[t]),i=a.getMonth()+1;10>i&&(i="0"+i);var s=a.getDate()+"/"+i+"/"+a.getFullYear();$("#id_expires").val(s),$("#id_expires_picker").datepicker("update",s)})}}}e.module("app.cases.directives").directive("updateCaseExpireDate",t)}(angular),function(e){"use strict";function t(t,a,n,r,i){function s(e,a,n,r,i,s,o){return t({url:"/search/search/",method:"GET",params:{type:"cases_case",q:e,page:a-1,size:n,sort:c(r,i),filterquery:o}}).then(function(e){return{cases:e.data.hits,total:e.data.total}})}function o(){return t({url:"/cases/casetypes/",method:"GET"}).then(function(e){return e.data.casetypes})}function c(e,t){var a="";return a+=t?"-":"",a+=e}function l(e,t){var a=n.defer(),r="archived:false AND NOT casetype_name:Callback";return r+=" AND assigned_to_id:"+currentUser.id,f.query({filterquery:r,sort:c(e,t)},function(e){a.resolve(e)}),a.promise}function u(t,a){var s="archived:false AND casetype_name:Callback";s+=" AND assigned_to_id:"+currentUser.id;var o=n.defer();return f.query({filterquery:s,sort:c(t,a)},function(t){e.forEach(t,function(e){e.account&&r.get({id:e.account},function(t){e.accountPhone=t.phone}),e.contact&&i.get({id:e.contact},function(t){e.contactPhone=t.phone})}),o.resolve(t)}),o.promise}function d(e,t,a){var n="archived:false AND _missing_:assigned_to_id";return n+=" AND assigned_to_groups:"+e,f.query({filterquery:n,sort:c(t,a)}).$promise}var f=a("/api/cases/case/:id",{},{query:{url:"/search/search/?type=cases_case&filterquery=:filterquery",isArray:!0,transformResponse:function(t){t=e.fromJson(t);var a=[];return t&&t.hits&&t.hits.length>0&&t.hits.forEach(function(e){a.push(e)}),a}},update:{method:"PATCH",params:{id:"@id"}}});return f.getCases=s,f.getCaseTypes=o,f.getMyCasesWidget=l,f.getCallbackRequests=u,f.getUnassignedCasesForTeam=d,f}e.module("app.cases.services").factory("Case",t),t.$inject=["$http","$resource","$q","AccountDetail","ContactDetail"]}(angular),function(e){"use strict";function t(t){return t("/search/search/?type=cases_case&filterquery=id::id",{},{get:{transformResponse:function(t){if(t=e.fromJson(t),t&&t.hits&&t.hits.length>0){var a=t.hits[0];return a}return null}},query:{url:"/search/search/?type=cases_case&filterquery=:filterquery",isArray:!0,transformResponse:function(t){t=e.fromJson(t);var a=[];return t&&t.hits&&t.hits.length>0&&t.hits.forEach(function(e){e=$.extend(e,{historyType:"case",color:"grey",date:e.expires}),a.push(e)}),a}},totalize:{url:"/search/search/?type=cases_case&size=0&filterquery=:filterquery",transformResponse:function(t){return t=e.fromJson(t),t&&t.total?{total:t.total}:{total:0}}}})}e.module("app.cases.services").factory("CaseDetail",t),t.$inject=["$resource"]}(angular),function(e){"use strict";function t(e){return e("/api/cases/statuses")}e.module("app.cases.services").factory("CaseStatuses",t),t.$inject=["$resource"]}(angular),function(e){"use strict";function t(e){return e("/api/cases/teams/:teamId/?is_assigned=False&is_archived=false&is_deleted=False")}e.module("app.cases.services").factory("UnassignedTeamCases",t),t.$inject=["$resource"]}(angular);
//# sourceMappingURL=app.min.js.map