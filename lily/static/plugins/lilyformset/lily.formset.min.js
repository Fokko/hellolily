(function(a){a.fn.formset=function(b){var c=a.extend({},a.fn.formset.defaults,b),d=c.extraClasses.join(" "),e=a(this),f=function(a,b){if(c.extraClasses){a.removeClass(d);a.addClass(c.extraClasses[b%c.extraClasses.length])}},g=function(a,b,c){var d=new RegExp("("+b+"-\\d+-)|(^)"),e=b+"-"+c+"-";if(a.attr("for"))a.attr("for",a.attr("for").replace(d,e));if(a.attr("id"))a.attr("id",a.attr("id").replace(d,e));if(a.attr("name"))a.attr("name",a.attr("name").replace(d,e))},h=function(a){return a.find("input,select,textarea,label").length>0},i=function(b,d){var e,f;if(c.preventEmptyFormset&&d.length===1){e=d.find("."+c.deleteCssClass);for(var g=0,h=e.length;g<h;g++){if((f=a(e[g]))!=undefined){a(f).removeClass("red").addClass("gray").attr("disabled","disabled")}else{a(e[g]).unbind("click")}}}else{e=a(d[0]).find("."+c.deleteCssClass);for(var g=0,h=e.length;g<h;g++){if((f=a(e[g]))!==undefined){a(f).removeClass("gray").addClass("red").removeAttr("disabled")}}}},j=function(b){b.find("."+c.deleteCssClass).click(function(){var b=a(this).parents("."+c.formCssClass),d=b.find('input:hidden[id $= "-DELETE"]');if(d.length){d.val("on");b.hide()}else{b.remove();var e=a("."+c.formCssClass).not(".formset-custom-template");a("#id_"+c.prefix+"-TOTAL_FORMS").val(e.length);for(var h=0,j=e.length;h<j;h++){f(e.eq(h),h);e.eq(h).find("input,select,textarea,label").each(function(){g(a(this),c.prefix,h)})}i(b,e)}if(c.removed)c.removed(b);return false})};e.each(function(b){var d=a(this),e=d.find('input:checkbox[id $= "-DELETE"]');if(e.length){e.before('<input type="hidden" name="'+e.attr("name")+'" id="'+e.attr("id")+'" />');e.remove()}if(h(d)){j(d);d.addClass(c.formCssClass);f(d,b);var g=a("."+c.formCssClass).not(".formset-custom-template");i(d,g)}});if(e.length){var k,l;if(c.formTemplate){l=c.formTemplate instanceof a?c.formTemplate:a(c.formTemplate);l.removeAttr("id").addClass(c.formCssClass).addClass("formset-custom-template");l.find("input,select,textarea,label").each(function(){g(a(this),c.prefix,2012)});j(l)}else{l=a("."+c.formCssClass+":last").clone(true).removeAttr("id");l.find('input:hidden[id $= "-DELETE"]').remove();l.find("input,select,textarea,label").each(function(){var b=a(this);if(b.is("input:checkbox")||b.is("input:radio")){b.attr("checked",false)}else{b.val("")}})}c.formTemplate=l;e.filter(":last").after('<a class="'+c.addCssClass+'" href="javascript:void(0)">'+c.addText+"</a>");k=e.filter(":last").next();k.click(function(){var b=parseInt(a("#id_"+c.prefix+"-TOTAL_FORMS").val()),d=c.formTemplate.clone(true).removeClass("formset-custom-template"),e=a(this).parents("tr."+c.formCssClass+"-add").get(0)||this;f(d,b);d.insertBefore(a(e)).show();d.find("input,select,textarea,label").each(function(){g(a(this),c.prefix,b)});a("#id_"+c.prefix+"-TOTAL_FORMS").val(b+1);var h=a("."+c.formCssClass).not(".formset-custom-template");i(d,h);if(c.added)c.added(d);return false})}return e};a.fn.formset.defaults={prefix:"form",formTemplate:null,addText:"add another",addCssClass:"add-row",deleteCssClass:"delete-row",formCssClass:"dynamic-form",extraClasses:[],added:null,removed:null,preventEmptyFormset:false}})(jQuery)